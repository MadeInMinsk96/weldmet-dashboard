<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–ú–æ–±–∏–ª—å–Ω—ã–π Dashboard - –ó–∞–∫–∞–∑—ã</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* –®–∞–ø–∫–∞ —Å –ø—Ä–æ—Ñ–∏–ª–µ–º */
        .app-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .app-title {
            font-size: 20px;
            font-weight: 700;
            color: #2c3e50;
            margin: 0;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
        }

        .user-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .user-avatar:active {
            transform: scale(0.95);
        }

        .user-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            padding: 10px 0;
            min-width: 150px;
            display: none;
            z-index: 1002;
        }

        .user-menu.active {
            display: block;
            animation: slideInDown 0.2s ease;
        }

        .user-menu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            color: #2c3e50;
            text-decoration: none;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .user-menu-item:hover {
            background: #f8f9fa;
        }

        .user-menu-item.logout {
            color: #e74c3c;
            border-top: 1px solid #ecf0f1;
        }

        .user-info {
            display: none;
        }

        /* –•–µ–¥–µ—Ä —Å –ø–æ–∏—Å–∫–æ–º */
        .mobile-header {
            position: fixed;
            top: 65px; /* –ü–æ–¥ —à–∞–ø–∫–æ–π */
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 10px 15px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }

        .search-container {
            position: relative;
            margin-bottom: 15px;
        }

        .search-input {
            width: 100%;
            padding: 12px 45px 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 25px;
            font-size: 16px;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #657786;
            font-size: 18px;
        }

        .clear-search {
            position: absolute;
            right: 45px;
            top: 50%;
            transform: translateY(-50%);
            background: #657786;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            display: none;
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫–æ–ª–æ–Ω–∫–∞–º */
        .column-navigation {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 0 0 5px 0;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .column-navigation::-webkit-scrollbar {
            display: none;
        }

        .nav-button {
            background: rgba(102, 126, 234, 0.1);
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 12px;
            font-weight: 600;
            color: #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .nav-button.active {
            background: #667eea;
            border-color: #667eea;
            color: white;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
        }

        .nav-button .count {
            margin-left: 5px;
            background: rgba(255,255,255,0.3);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
        .mobile-content {
            margin-top: 185px; /* –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π –æ—Ç—Å—Ç—É–ø –ø–æ–¥ —à–∞–ø–∫—É + –ø–æ–∏—Å–∫ + –Ω–∞–≤–∏–≥–∞—Ü–∏—é */
            height: calc(100vh - 185px);
            position: relative;
            overflow: hidden;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–ª–∞–π–¥–æ–≤ */
        .slides-container {
            display: flex;
            width: 700%;
            height: 100%;
            transition: transform 0.3s ease;
            touch-action: pan-y;
        }

        /* –û—Ç–¥–µ–ª—å–Ω—ã–π —Å–ª–∞–π–¥ (–∫–æ–ª–æ–Ω–∫–∞) */
        .column-slide {
            width: 14.286%;
            height: 100%;
            padding: 15px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .column-header {
            text-align: center;
            color: white;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–∫–∞–∑–æ–≤ */
        .order-card {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            animation: slideInUp 0.5s ease;
        }

        .order-card:active {
            transform: scale(0.98);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .order-number {
            font-size: 16px;
            font-weight: 700;
            color: #2c3e50;
        }

        .priority-badge {
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority-high { background: #fee; color: #c53030; }
        .priority-medium { background: #fff3cd; color: #856404; }
        .priority-low { background: #d1ecf1; color: #0c5460; }

        .order-info {
            font-size: 14px;
            color: #657786;
            margin: 5px 0;
        }

        .order-manager {
            font-weight: 600;
            color: #667eea;
        }

        .order-date {
            font-size: 12px;
            color: #95a5a6;
            margin-top: 10px;
        }

        .stages-progress {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #ecf0f1;
        }

        .stage-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 5px 0;
            font-size: 12px;
        }

        .stage-status {
            padding: 2px 6px;
            border-radius: 8px;
            font-weight: 600;
        }

        .status-completed { background: #d4edda; color: #155724; }
        .status-in-progress { background: #fff3cd; color: #856404; }
        .status-not-started { background: #f8d7da; color: #721c24; }

        /* –°—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loading-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            z-index: 2000;
            display: none;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        .loading-text {
            text-align: center;
            color: #657786;
            font-size: 14px;
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å–∞ */
        .online-indicator {
            position: fixed;
            top: 135px; /* –ü–æ–¥ —É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–π —à–∞–ø–∫–æ–π */
            right: 15px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4CAF50;
            z-index: 1001;
            animation: pulse 2s infinite;
        }

        .online-indicator.offline {
            background: #f44336;
            animation: none;
        }

        /* –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: rgba(255, 255, 255, 0.8);
        }

        .empty-state .icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.6;
        }

        .empty-state .text {
            font-size: 16px;
            font-weight: 500;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(76, 175, 80, 0); }
            100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); }
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–µ–ª–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (max-width: 350px) {
            .mobile-header {
                padding: 8px 10px;
            }
            
            .column-slide {
                padding: 10px;
            }
            
            .order-card {
                padding: 12px;
                margin-bottom: 12px;
            }
        }

        /* –°–∫—Ä—ã—Ç–∏–µ —Å–∫—Ä–æ–ª–ª–±–∞—Ä–æ–≤ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
        .column-slide::-webkit-scrollbar {
            display: none;
        }

        .column-slide {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .modal {
            background: white;
            border-radius: 20px;
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: slideInUp 0.3s ease;
            position: relative;
        }

        .modal-header {
            padding: 20px 20px 0 20px;
            border-bottom: 1px solid #e1e8ed;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: #657786;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s ease;
        }

        .modal-close:hover {
            background: #f8f9fa;
        }

        .modal-body {
            padding: 0 20px 20px 20px;
        }

        .order-detail-section {
            margin-bottom: 20px;
        }

        /* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å–µ–∫—Ü–∏–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è */
        .movement-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .movement-section .order-detail-title {
            color: white;
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .order-detail-title {
            font-size: 14px;
            font-weight: 600;
            color: #657786;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .order-detail-value {
            font-size: 16px;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .stages-detail {
            display: grid;
            gap: 10px;
        }

        .stage-detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .stage-detail-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stage-detail-time {
            font-size: 14px;
            color: #657786;
        }

        .stage-detail-status {
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 600;
        }

        .stage-detail-status.completed {
            background: #d4edda;
            color: #155724;
        }

        .stage-detail-status.in-progress {
            background: #fff3cd;
            color: #856404;
        }

        .stage-detail-status.not-required {
            background: #e2e3e5;
            color: #6c757d;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        /* –§–æ—Ä–º–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –ø—Ä–æ–±–ª–µ–º–µ */
        .problem-form {
            display: none;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e1e8ed;
        }

        .problem-form.active {
            display: block;
            animation: slideInUp 0.3s ease;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.2s ease;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-textarea {
            min-height: 80px;
        }

        /* –ö–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤ */
        .movement-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 10px;
        }

        .movement-btn {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 10px 12px;
            font-size: 13px;
            font-weight: 600;
            color: #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .movement-btn:hover {
            background: rgba(255, 255, 255, 1);
            border-color: rgba(255, 255, 255, 0.8);
            color: #5a6fd8;
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        .movement-btn.current {
            background: linear-gradient(135deg, #28a745, #20c997);
            border-color: #28a745;
            color: white;
            cursor: not-allowed;
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
        }

        .movement-btn.current:hover {
            transform: none;
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .movement-btn.disabled {
            background: rgba(255, 255, 255, 0.5);
            border-color: rgba(255, 255, 255, 0.3);
            color: rgba(108, 117, 125, 0.7);
            cursor: not-allowed;
            box-shadow: none;
        }

        .movement-btn.disabled:hover {
            transform: none;
            background: rgba(255, 255, 255, 0.5);
            color: rgba(108, 117, 125, 0.7);
            box-shadow: none;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <!-- –®–∞–ø–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <div class="app-header">
        <h1 class="app-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏</h1>
        
        <div class="user-profile">
            <div class="user-avatar" id="userAvatar">–ò–ò</div>
            <div class="user-menu" id="userMenu">
                <div class="user-menu-item" onclick="showProfile()">
                    üë§ –ü—Ä–æ—Ñ–∏–ª—å
                </div>
                <div class="user-menu-item" onclick="openReports()">
                    üìä –û—Ç—á–µ—Ç—ã
                </div>
                <div class="user-menu-item" onclick="showSettings()">
                    ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                </div>
                <div class="user-menu-item logout" onclick="logout()">
                    üö™ –í—ã—Ö–æ–¥
                </div>
            </div>
        </div>
    </div>

    <!-- –•–µ–¥–µ—Ä —Å –ø–æ–∏—Å–∫–æ–º –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π -->
    <div class="mobile-header">
        <div class="search-container">
            <input type="text" class="search-input" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∑–∞–∫–∞–∑–∞–º..." id="searchInput">
            <button class="clear-search" id="clearSearch">√ó</button>
            <span class="search-icon">üîç</span>
        </div>
        
        <div class="column-navigation" id="columnNav">
            <button class="nav-button active" data-column="0">
                üìã –í—Å–µ –∑–∞–∫–∞–∑—ã <span class="count">0</span>
            </button>
            <button class="nav-button" data-column="1">
                ‚úÇÔ∏è –†–µ–∑–∫–∞ <span class="count">0</span>
            </button>
            <button class="nav-button" data-column="2">
                üßΩ –ó–∞—á–∏—Å—Ç–∫–∞ <span class="count">0</span>
            </button>
            <button class="nav-button" data-column="3">
                üîß –ì–∏–±–∫–∞ <span class="count">0</span>
            </button>
            <button class="nav-button" data-column="4">
                üî• –°–≤–∞—Ä–∫–∞ <span class="count">0</span>
            </button>
            <button class="nav-button" data-column="5">
                üé® –ü–æ–∫—Ä–∞—Å–∫–∞ <span class="count">0</span>
            </button>
            <button class="nav-button" data-column="6">
                üì¶ –°–∫–ª–∞–¥ <span class="count">0</span>
            </button>
        </div>
    </div>

    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å–∞ -->
    <div class="online-indicator" id="onlineIndicator"></div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="mobile-content">
        <div class="slides-container" id="slidesContainer">
            <!-- –í—Å–µ –∑–∞–∫–∞–∑—ã -->
            <div class="column-slide" data-stage="all">
                <div class="column-header">üìã –í—Å–µ –∑–∞–∫–∞–∑—ã</div>
                <div class="orders-list" id="all-orders"></div>
            </div>
            
            <!-- –†–µ–∑–∫–∞ -->
            <div class="column-slide" data-stage="cutting">
                <div class="column-header">‚úÇÔ∏è –†–µ–∑–∫–∞</div>
                <div class="orders-list" id="cutting-orders"></div>
            </div>
            
            <!-- –ó–∞—á–∏—Å—Ç–∫–∞/—Ç—Ä–∞–≤–ª–µ–Ω–∏–µ -->
            <div class="column-slide" data-stage="cleaning">
                <div class="column-header">üßΩ –ó–∞—á–∏—Å—Ç–∫–∞/—Ç—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
                <div class="orders-list" id="cleaning-orders"></div>
            </div>
            
            <!-- –ì–∏–±–∫–∞ -->
            <div class="column-slide" data-stage="bending">
                <div class="column-header">üîß –ì–∏–±–∫–∞</div>
                <div class="orders-list" id="bending-orders"></div>
            </div>
            
            <!-- –°–≤–∞—Ä–∫–∞ -->
            <div class="column-slide" data-stage="welding">
                <div class="column-header">üî• –°–≤–∞—Ä–∫–∞</div>
                <div class="orders-list" id="welding-orders"></div>
            </div>
            
            <!-- –ü–æ–∫—Ä–∞—Å–∫–∞ -->
            <div class="column-slide" data-stage="painting">
                <div class="column-header">üé® –ü–æ–∫—Ä–∞—Å–∫–∞</div>
                <div class="orders-list" id="painting-orders"></div>
            </div>
            
            <!-- –°–∫–ª–∞–¥ -->
            <div class="column-slide" data-stage="storage">
                <div class="column-header">üì¶ –°–∫–ª–∞–¥</div>
                <div class="orders-list" id="storage-orders"></div>
            </div>
        </div>
    </div>

    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div class="loading-indicator" id="loadingIndicator">
        <div class="spinner"></div>
        <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞–∫–∞–∑–∞ -->
    <div class="modal-overlay" id="orderDetailModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modalOrderNumber">–ó–∞–∫–∞–∑ #</h3>
                <button class="modal-close" onclick="closeOrderDetail()">√ó</button>
            </div>
            <div class="modal-body">
                <!-- –ü–ï–†–í–´–ô –ë–õ–û–ö: –ö–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ -->
                <div class="order-detail-section movement-section">
                    <div class="order-detail-title">üöÄ –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –∑–∞–∫–∞–∑</div>
                    <div class="movement-buttons" id="movementButtons">
                        <!-- –ö–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>

                <!-- –í–¢–û–†–û–ô –ë–õ–û–ö: –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                <div class="order-detail-section">
                    <div class="order-detail-title">üìã –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
                    <div class="order-detail-value"><strong>–ú–µ–Ω–µ–¥–∂–µ—Ä:</strong> <span id="modalManager"></span></div>
                    <div class="order-detail-value"><strong>–¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏:</strong> <span id="modalOperationType"></span></div>
                    <div class="order-detail-value"><strong>–î–∞—Ç–∞ –æ—Ç–≥—Ä—É–∑–∫–∏:</strong> <span id="modalShipmentDate"></span></div>
                    <div class="order-detail-value"><strong>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:</strong> <span id="modalPriority"></span></div>
                    <div class="order-detail-value"><strong>–¢–µ–∫—É—â–∏–π —ç—Ç–∞–ø:</strong> <span id="modalCurrentStage"></span></div>
                </div>

                <!-- –¢–†–ï–¢–ò–ô –ë–õ–û–ö: –≠—Ç–∞–ø—ã –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ -->
                <div class="order-detail-section">
                    <div class="order-detail-title">‚öôÔ∏è –≠—Ç–∞–ø—ã –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞</div>
                    <div class="stages-detail" id="modalStagesDetail"></div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-danger" onclick="showProblemForm()">
                        ‚ö†Ô∏è –ï—Å—Ç—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
                    </button>
                    <button class="btn btn-secondary" onclick="closeOrderDetail()">
                        –ó–∞–∫—Ä—ã—Ç—å
                    </button>
                </div>

                <!-- –§–æ—Ä–º–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –ø—Ä–æ–±–ª–µ–º–µ -->
                <div class="problem-form" id="problemForm">
                    <div class="order-detail-title">–°–æ–æ–±—â–∏—Ç—å –æ –ø—Ä–æ–±–ª–µ–º–µ</div>
                    
                    <div class="form-group">
                        <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:</label>
                        <textarea 
                            class="form-textarea" 
                            id="problemDescription" 
                            placeholder="–û–ø–∏—à–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω–æ –≤–æ–∑–Ω–∏–∫—à—É—é –ø—Ä–æ–±–ª–µ–º—É..."
                            rows="4"
                        ></textarea>
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-danger" onclick="submitProblem()">
                            üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
                        </button>
                        <button class="btn btn-secondary" onclick="hideProblemForm()">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let orders = [];
        let filteredOrders = [];
        let currentSlide = 0;
        let touchStartX = 0;
        let touchStartY = 0;
        let isScrolling = null;
        let autoUpdateInterval;
        let searchValue = '';
        let currentOrderDetail = null; // –¢–µ–∫—É—â–∏–π –∑–∞–∫–∞–∑ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
        
        // URL –¥–ª—è Google Viz API (—Ä–∞–±–æ—á–∏–π –º–µ—Ç–æ–¥ –∏–∑ —Ç–µ—Å—Ç–∞)
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/1fOF3IU94lgNTdgaTiKPj-gcoz_cBq9pVZoaj1tGcF9U/gviz/tq?tqx=out:csv&gid=1485484311';
        
        // –ú–∞–ø–ø–∏–Ω–≥ —ç—Ç–∞–ø–æ–≤
        const STAGE_COLUMNS = {
            all: 'all-orders',
            cutting: 'cutting-orders',
            cleaning: 'cleaning-orders', 
            bending: 'bending-orders',
            welding: 'welding-orders',
            painting: 'painting-orders',
            storage: 'storage-orders'
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        async function initializeApp() {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ dashboard...');
            
            setupEventListeners();
            setupTouchEvents();
            setupUserProfile();
            await loadInitialData();
            startAutoUpdate();
            
            console.log('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ!');
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function setupUserProfile() {
            const userAvatar = document.getElementById('userAvatar');
            const userMenu = document.getElementById('userMenu');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            loadUserData();
            
            // –ö–ª–∏–∫ –ø–æ –∞–≤–∞—Ç–∞—Ä—É - –ø–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –º–µ–Ω—é
            userAvatar.addEventListener('click', (e) => {
                e.stopPropagation();
                userMenu.classList.toggle('active');
            });
            
            // –ö–ª–∏–∫ –≤–Ω–µ –º–µ–Ω—é - –∑–∞–∫—Ä—ã—Ç—å –º–µ–Ω—é
            document.addEventListener('click', () => {
                userMenu.classList.remove('active');
            });
            
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∑–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –ø–æ —Å–∞–º–æ–º—É –º–µ–Ω—é
            userMenu.addEventListener('click', (e) => {
                e.stopPropagation();
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function loadUserData() {
            const userData = localStorage.getItem('weldmet_user');
            const userAvatar = document.getElementById('userAvatar');
            
            if (userData) {
                try {
                    const user = JSON.parse(userData);
                    userAvatar.textContent = getInitials(user.name);
                    console.log(`üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${user.name}`);
                } catch (error) {
                    // –î–∞–Ω–Ω—ã–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω—ã - –∏—Å–ø–æ–ª—å–∑—É–µ–º –≥–æ—Å—Ç–µ–≤–æ–π —Ä–µ–∂–∏–º
                    userAvatar.textContent = '–ì–°';
                    console.log('‚ö†Ô∏è –ì–æ—Å—Ç–µ–≤–æ–π —Ä–µ–∂–∏–º');
                }
            } else {
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const testUser = {
                    name: '–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤',
                    role: '–ú–∞—Å—Ç–µ—Ä —É—á–∞—Å—Ç–∫–∞',
                    email: 'ivan@example.com'
                };
                localStorage.setItem('weldmet_user', JSON.stringify(testUser));
                userAvatar.textContent = getInitials(testUser.name);
                console.log(`üë§ –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${testUser.name}`);
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
        function showProfile() {
            const userData = JSON.parse(localStorage.getItem('weldmet_user'));
            if (userData) {
                alert(`üë§ –ü—Ä–æ—Ñ–∏–ª—å:\n\n–ò–º—è: ${userData.name}\n–†–æ–ª—å: ${userData.role || '–°–æ—Ç—Ä—É–¥–Ω–∏–∫'}\nEmail: ${userData.email || '–ù–µ —É–∫–∞–∑–∞–Ω'}`);
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        function showSettings() {
            alert('‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö');
        }

        // –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ—Ç—á–µ—Ç–æ–≤
        function openReports() {
            window.open('reports.html', '_blank');
            console.log('üìä –û—Ç–∫—Ä—ã—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç—á–µ—Ç–æ–≤');
        }

        // –í—ã—Ö–æ–¥ –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è
        function logout() {
            if (confirm('üö™ –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
                localStorage.removeItem('weldmet_user');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                alert('üëã –í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã');
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                window.location.reload();
            }
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª–µ–π —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –ü–æ–∏—Å–∫
            const searchInput = document.getElementById('searchInput');
            const clearSearch = document.getElementById('clearSearch');
            
            searchInput.addEventListener('input', handleSearch);
            clearSearch.addEventListener('click', clearSearchInput);
            
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫–æ–ª–æ–Ω–∫–∞–º
            const navButtons = document.querySelectorAll('.nav-button');
            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const column = parseInt(button.dataset.column);
                    goToSlide(column);
                });
            });
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ touch —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Å–≤–∞–π–ø–∞
        function setupTouchEvents() {
            const slidesContainer = document.getElementById('slidesContainer');
            
            slidesContainer.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
                isScrolling = null;
            }, { passive: true });
            
            slidesContainer.addEventListener('touchmove', (e) => {
                if (!touchStartX || !touchStartY) return;
                
                let touchX = e.touches[0].clientX;
                let touchY = e.touches[0].clientY;
                let diffX = touchStartX - touchX;
                let diffY = touchStartY - touchY;
                
                if (isScrolling === null) {
                    isScrolling = Math.abs(diffX) < Math.abs(diffY);
                }
                
                // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª –ø—Ä–∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–º
                if (!isScrolling) {
                    e.preventDefault();
                }
            }, { passive: false });
            
            slidesContainer.addEventListener('touchend', (e) => {
                if (!touchStartX || isScrolling) return;
                
                let touchEndX = e.changedTouches[0].clientX;
                let diff = touchStartX - touchEndX;
                
                // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Å–≤–∞–π–ø–∞
                if (Math.abs(diff) > 50) {
                    if (diff > 0 && currentSlide < 6) {
                        // –°–≤–∞–π–ø –≤–ª–µ–≤–æ - —Å–ª–µ–¥—É—é—â–∏–π —Å–ª–∞–π–¥
                        goToSlide(currentSlide + 1);
                    } else if (diff < 0 && currentSlide > 0) {
                        // –°–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ - –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Å–ª–∞–π–¥
                        goToSlide(currentSlide - 1);
                    }
                }
                
                touchStartX = 0;
                touchStartY = 0;
                isScrolling = null;
            }, { passive: true });
        }

        // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–∞–π–¥—É
        function goToSlide(slideIndex) {
            if (slideIndex < 0 || slideIndex > 6) return;
            
            currentSlide = slideIndex;
            const slidesContainer = document.getElementById('slidesContainer');
            const translateX = -slideIndex * 14.286;
            
            slidesContainer.style.transform = `translateX(${translateX}%)`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            document.querySelectorAll('.nav-button').forEach((btn, index) => {
                btn.classList.toggle('active', index === slideIndex);
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Google Sheets
        async function loadOrdersData() {
            try {
                showLoading(true);
                updateOnlineStatus(true);
                
                console.log('üì• –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Google Sheets...');
                
                const response = await fetch(SHEET_URL, {
                    mode: 'cors'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const csvText = await response.text();
                console.log(`‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã, —Ä–∞–∑–º–µ—Ä: ${csvText.length} —Å–∏–º–≤–æ–ª–æ–≤`);
                
                parseOrdersData(csvText);
                updateOnlineStatus(true);
                
                return orders;
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                updateOnlineStatus(false);
                
                // –ü—Ä–∏ –æ—à–∏–±–∫–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                loadTestData();
                return orders;
            } finally {
                showLoading(false);
            }
        }

        // –ü–∞—Ä—Å–∏–Ω–≥ CSV –¥–∞–Ω–Ω—ã—Ö
        function parseOrdersData(csvText) {
            const lines = csvText.split('\n');
            orders = [];
            
            console.log(`üìä –û–±—Ä–∞–±–æ—Ç–∫–∞ ${lines.length} —Å—Ç—Ä–æ–∫ –¥–∞–Ω–Ω—ã—Ö...`);
            
            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ (–ø–µ—Ä–≤—ã–µ 9 —Å—Ç—Ä–æ–∫)
            for (let i = 9; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                const columns = parseCSVLine(line);
                if (columns.length < 17) continue;
                
                const order = parseOrderRow(columns);
                if (order && order.orderNumber) {
                    orders.push(order);
                }
            }
            
            console.log(`‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ ${orders.length} –∑–∞–∫–∞–∑–æ–≤`);
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–∏—Å–∫ –µ—Å–ª–∏ –µ—Å—Ç—å
            if (searchValue) {
                filterOrders(searchValue);
            } else {
                filteredOrders = [...orders];
            }
            
            renderOrders();
            updateColumnCounts();
        }

        // –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–æ–∫–∏ CSV
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current);
            
            return result;
        }

        // –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–æ–∫–∏ –∑–∞–∫–∞–∑–∞
        function parseOrderRow(columns) {
            const orderStatus = columns[1]?.trim() || '';
            const manager = columns[2]?.trim() || '';
            const orderNumber = columns[3]?.trim() || '';
            const operationType = columns[4]?.trim() || '';
            const shipmentDate = columns[5]?.trim() || '';
            
            if (!orderNumber || orderNumber === '–ù–æ–º–µ—Ä –∑–∞—è–≤–∫–∏') return null;
            
            // –ü–∞—Ä—Å–∏–º —ç—Ç–∞–ø—ã –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞
            const stages = {
                cutting: {
                    time: columns[6]?.trim() || '',
                    isCompleted: columns[7]?.trim().toLowerCase() === '–≥–æ—Ç–æ–≤–æ' || columns[7]?.trim() === '+',
                    hasWork: parseFloat(columns[6]?.trim() || '0') > 0
                },
                cleaning: {
                    time: columns[8]?.trim() || '',
                    isCompleted: columns[9]?.trim().toLowerCase() === '–≥–æ—Ç–æ–≤–æ' || columns[9]?.trim() === '+',
                    hasWork: parseFloat(columns[8]?.trim() || '0') > 0
                },
                bending: {
                    time: columns[10]?.trim() || '',
                    isCompleted: columns[11]?.trim().toLowerCase() === '–≥–æ—Ç–æ–≤–æ' || columns[11]?.trim() === '+',
                    hasWork: parseFloat(columns[10]?.trim() || '0') > 0
                },
                welding: {
                    time: columns[12]?.trim() || '',
                    isCompleted: columns[13]?.trim().toLowerCase() === '–≥–æ—Ç–æ–≤–æ' || columns[13]?.trim() === '+',
                    hasWork: parseFloat(columns[12]?.trim() || '0') > 0
                },
                painting: {
                    time: columns[14]?.trim() || '',
                    isCompleted: columns[15]?.trim().toLowerCase() === '–≥–æ—Ç–æ–≤–æ' || columns[15]?.trim() === '+',
                    hasWork: parseFloat(columns[14]?.trim() || '0') > 0
                }
            };

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏–π —ç—Ç–∞–ø —Å —É—á–µ—Ç–æ–º —Ä–∞—Å—á–µ—Ç–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
            let currentStage = 'storage'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫–ª–∞–¥
            const stageOrder = ['cutting', 'cleaning', 'bending', 'welding', 'painting'];
            
            // –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ —ç—Ç–∞–ø–∞–º –∏ –Ω–∞—Ö–æ–¥–∏–º —Ç–µ–∫—É—â–∏–π
            for (let stage of stageOrder) {
                const stageData = stages[stage];
                
                // –ï—Å–ª–∏ —É —ç—Ç–∞–ø–∞ –Ω–µ—Ç —Ä–∞–±–æ—Ç—ã (–≤—Ä–µ–º—è = 0) - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                if (!stageData.hasWork) {
                    continue;
                }
                
                // –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–∞–±–æ—Ç–∞ –Ω–æ –Ω–µ –≥–æ—Ç–æ–≤–æ - —ç—Ç–æ —Ç–µ–∫—É—â–∏–π —ç—Ç–∞–ø
                if (stageData.hasWork && !stageData.isCompleted) {
                    currentStage = stage;
                    break;
                }
                
                // –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–∞–±–æ—Ç–∞ –∏ –≥–æ—Ç–æ–≤–æ - —ç—Ç–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø–æ–∏—Å–∫
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Å–µ –ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —ç—Ç–∞–ø—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã
            const requiredStages = stageOrder.filter(stage => stages[stage].hasWork);
            const allRequiredCompleted = requiredStages.every(stage => stages[stage].isCompleted);
            
            if (allRequiredCompleted && requiredStages.length > 0) {
                currentStage = 'storage';
            }
            
            // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            console.log(`üìã –ó–∞–∫–∞–∑ ${orderNumber}:`, {
                —Ç—Ä–µ–±—É–µ–º—ã–µ–≠—Ç–∞–ø—ã: requiredStages,
                –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ–≠—Ç–∞–ø—ã: requiredStages.filter(stage => stages[stage].isCompleted),
                —Ç–µ–∫—É—â–∏–π–≠—Ç–∞–ø: currentStage
            });

            return {
                orderNumber,
                manager,
                operationType,
                shipmentDate,
                orderStatus,
                stages,
                currentStage,
                priority: calculatePriority(shipmentDate, stages)
            };
        }

        // –†–∞—Å—á–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
        function calculatePriority(shipmentDate, stages) {
            if (!shipmentDate) return 'medium';
            
            const shipDate = new Date(shipmentDate);
            const today = new Date();
            const daysUntilShipment = Math.ceil((shipDate - today) / (1000 * 60 * 60 * 24));
            
            // –°—á–∏—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ —ç—Ç–∞–ø—ã —Å —Ä–∞–±–æ—Ç–æ–π
            const stagesWithWork = Object.values(stages).filter(stage => stage.hasWork);
            const completedStages = stagesWithWork.filter(stage => stage.isCompleted).length;
            const totalRequiredStages = stagesWithWork.length;
            
            if (daysUntilShipment <= 2 && completedStages < totalRequiredStages) return 'high';
            if (daysUntilShipment <= 7) return 'medium';
            return 'low';
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
        function renderOrders() {
            // –û—á–∏—â–∞–µ–º –≤—Å–µ –∫–æ–ª–æ–Ω–∫–∏
            Object.values(STAGE_COLUMNS).forEach(columnId => {
                const container = document.getElementById(columnId);
                if (container) {
                    container.innerHTML = '';
                }
            });

            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –∑–∞–∫–∞–∑—ã –ø–æ —ç—Ç–∞–ø–∞–º
            const ordersByStage = {
                all: [...filteredOrders], // –í—Å–µ –∑–∞–∫–∞–∑—ã –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —Å–ª–∞–π–¥–∞
                cutting: [],
                cleaning: [],
                bending: [],
                welding: [],
                painting: [],
                storage: []
            };

            filteredOrders.forEach(order => {
                if (ordersByStage[order.currentStage]) {
                    ordersByStage[order.currentStage].push(order);
                }
            });

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∑–∞–∫–∞–∑—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–ª–æ–Ω–∫–∞—Ö
            Object.entries(ordersByStage).forEach(([stage, stageOrders]) => {
                const container = document.getElementById(STAGE_COLUMNS[stage]);
                if (!container) return;

                if (stageOrders.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="icon">${getStageIcon(stage)}</div>
                            <div class="text">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div>
                        </div>
                    `;
                    return;
                }

                stageOrders.forEach(order => {
                    const orderCard = createOrderCard(order);
                    container.appendChild(orderCard);
                });
            });
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–∫–∞–∑–∞
        function createOrderCard(order) {
            const card = document.createElement('div');
            card.className = 'order-card';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏
            card.addEventListener('click', () => {
                openOrderDetail(order);
            });
            
            const priorityClass = `priority-${order.priority}`;
            const priorityText = {
                'high': '–°—Ä–æ—á–Ω–æ',
                'medium': '–°—Ä–µ–¥–Ω–∏–π',
                'low': '–ù–∏–∑–∫–∏–π'
            }[order.priority] || '–°—Ä–µ–¥–Ω–∏–π';

            card.innerHTML = `
                <div class="order-header">
                    <div class="order-number">${order.orderNumber}</div>
                    <div class="priority-badge ${priorityClass}">${priorityText}</div>
                </div>
                
                <div class="order-info">
                    <div class="order-manager">üë§ ${order.manager}</div>
                    <div style="margin: 5px 0;">üîß ${order.operationType}</div>
                    ${order.shipmentDate ? `<div class="order-date">üìÖ –û—Ç–≥—Ä—É–∑–∫–∞: ${order.shipmentDate}</div>` : ''}
                </div>

                <div class="stages-progress">
                    ${Object.entries(order.stages)
                        .filter(([stageName, stage]) => stage.hasWork) // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —ç—Ç–∞–ø—ã —Å —Ä–∞–±–æ—Ç–æ–π
                        .map(([stageName, stage]) => `
                        <div class="stage-item">
                            <span>${getStageName(stageName)} (${formatStageTime(stageName, stage.time)})</span>
                            <span class="stage-status ${getStageStatusClass(stage)}">
                                ${stage.isCompleted ? '–ì–æ—Ç–æ–≤–æ' : '–í —Ä–∞–±–æ—Ç–µ'}
                            </span>
                        </div>
                    `).join('')}
                </div>
            `;

            return card;
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∫–æ–Ω–∫–∏ —ç—Ç–∞–ø–∞
        function getStageIcon(stage) {
            const icons = {
                all: 'üìã',
                cutting: '‚úÇÔ∏è',
                cleaning: 'üßΩ',
                bending: 'üîß',
                welding: 'üî•',
                painting: 'üé®',
                storage: 'üì¶'
            };
            return icons[stage] || 'üìã';
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —ç—Ç–∞–ø–∞
        function getStageName(stage) {
            const names = {
                all: '–í—Å–µ –∑–∞–∫–∞–∑—ã',
                cutting: '–†–µ–∑–∫–∞',
                cleaning: '–ó–∞—á–∏—Å—Ç–∫–∞',
                bending: '–ì–∏–±–∫–∞',
                welding: '–°–≤–∞—Ä–∫–∞',
                painting: '–ü–æ–∫—Ä–∞—Å–∫–∞'
            };
            return names[stage] || stage;
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –µ–¥–∏–Ω–∏—Ü–∞–º–∏ –∏–∑–º–µ—Ä–µ–Ω–∏—è
        function formatStageTime(stageName, time) {
            if (!time || time === '0') return '';
            
            // –†–µ–∑–∫–∞ –∏–∑–º–µ—Ä—è–µ—Ç—Å—è –≤ –º–∏–Ω—É—Ç–∞—Ö
            if (stageName === 'cutting') {
                return `${time}–º–∏–Ω`;
            }
            
            // –û—Å—Ç–∞–ª—å–Ω—ã–µ —ç—Ç–∞–ø—ã –≤ —á–∞—Å–∞—Ö (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ –∏–Ω–æ–µ)
            return `${time}—á`;
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞ —Å—Ç–∞—Ç—É—Å–∞ —ç—Ç–∞–ø–∞
        function getStageStatusClass(stage) {
            if (!stage.hasWork) return 'status-not-started'; // –≠—Ç–∞–ø –Ω–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è
            if (stage.isCompleted) return 'status-completed'; // –≠—Ç–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω
            return 'status-in-progress'; // –≠—Ç–∞–ø –≤ —Ä–∞–±–æ—Ç–µ
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤ –∫–æ–ª–æ–Ω–æ–∫
        function updateColumnCounts() {
            const ordersByStage = {
                all: filteredOrders.length, // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤
                cutting: 0,
                cleaning: 0,
                bending: 0,
                welding: 0,
                painting: 0,
                storage: 0
            };

            filteredOrders.forEach(order => {
                if (ordersByStage.hasOwnProperty(order.currentStage)) {
                    ordersByStage[order.currentStage]++;
                }
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏ –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            const navButtons = document.querySelectorAll('.nav-button');
            const stages = ['all', 'cutting', 'cleaning', 'bending', 'welding', 'painting', 'storage'];
            
            navButtons.forEach((button, index) => {
                const countElement = button.querySelector('.count');
                if (countElement && stages[index]) {
                    countElement.textContent = ordersByStage[stages[index]];
                }
            });
        }

        // –ü–æ–∏—Å–∫ –ø–æ –∑–∞–∫–∞–∑–∞–º
        function handleSearch(event) {
            searchValue = event.target.value.toLowerCase();
            const clearButton = document.getElementById('clearSearch');
            
            clearButton.style.display = searchValue ? 'block' : 'none';
            
            if (searchValue) {
                filterOrders(searchValue);
            } else {
                filteredOrders = [...orders];
            }
            
            renderOrders();
            updateColumnCounts();
        }

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤
        function filterOrders(searchText) {
            filteredOrders = orders.filter(order => {
                return order.orderNumber.toLowerCase().includes(searchText) ||
                       order.manager.toLowerCase().includes(searchText) ||
                       order.operationType.toLowerCase().includes(searchText);
            });
        }

        // –û—á–∏—Å—Ç–∫–∞ –ø–æ–∏—Å–∫–∞
        function clearSearchInput() {
            const searchInput = document.getElementById('searchInput');
            const clearButton = document.getElementById('clearSearch');
            
            searchInput.value = '';
            searchValue = '';
            clearButton.style.display = 'none';
            
            filteredOrders = [...orders];
            renderOrders();
            updateColumnCounts();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        function showLoading(show) {
            const indicator = document.getElementById('loadingIndicator');
            indicator.style.display = show ? 'block' : 'none';
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –æ–Ω–ª–∞–π–Ω
        function updateOnlineStatus(online) {
            const indicator = document.getElementById('onlineIndicator');
            indicator.classList.toggle('offline', !online);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        function loadTestData() {
            console.log('üìã –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö...');
            
            orders = [
                {
                    orderNumber: 'TEST-001',
                    manager: '–ò–≤–∞–Ω–æ–≤ –ò.–ò.',
                    operationType: '–†–µ–∑–∫–∞ –∏ –≥–∏–±–∫–∞',
                    shipmentDate: '2025-01-15',
                    orderStatus: '–í —Ä–∞–±–æ—Ç–µ',
                    currentStage: 'cutting',
                    priority: 'high',
                    stages: {
                        cutting: { time: '45', isCompleted: false, hasWork: true }, // 45 –º–∏–Ω—É—Ç
                        cleaning: { time: '0', isCompleted: false, hasWork: false }, // –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∑–∞—á–∏—Å—Ç–∫–∏
                        bending: { time: '1', isCompleted: false, hasWork: true }, // 1 —á–∞—Å
                        welding: { time: '0', isCompleted: false, hasWork: false }, // –ù–µ —Ç—Ä–µ–±—É–µ—Ç —Å–≤–∞—Ä–∫–∏
                        painting: { time: '0', isCompleted: false, hasWork: false } // –ù–µ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–∫—Ä–∞—Å–∫–∏
                    }
                },
                {
                    orderNumber: 'TEST-002',
                    manager: '–ü–µ—Ç—Ä–æ–≤ –ü.–ü.',
                    operationType: '–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª',
                    shipmentDate: '2025-01-20',
                    orderStatus: '–í —Ä–∞–±–æ—Ç–µ',
                    currentStage: 'welding',
                    priority: 'medium',
                    stages: {
                        cutting: { time: '30', isCompleted: true, hasWork: true }, // 30 –º–∏–Ω—É—Ç
                        cleaning: { time: '0.5', isCompleted: true, hasWork: true }, // 0.5 —á–∞—Å–∞
                        bending: { time: '1', isCompleted: true, hasWork: true }, // 1 —á–∞—Å
                        welding: { time: '3', isCompleted: false, hasWork: true }, // 3 —á–∞—Å–∞
                        painting: { time: '2', isCompleted: false, hasWork: true } // 2 —á–∞—Å–∞
                    }
                },
                {
                    orderNumber: 'TEST-003',
                    manager: '–°–∏–¥–æ—Ä–æ–≤ –°.–°.',
                    operationType: '–¢–æ–ª—å–∫–æ —Å–≤–∞—Ä–∫–∞',
                    shipmentDate: '2025-01-25',
                    orderStatus: '–í —Ä–∞–±–æ—Ç–µ',
                    currentStage: 'welding',
                    priority: 'low',
                    stages: {
                        cutting: { time: '0', isCompleted: false, hasWork: false }, // –ü—Ä–æ–ø—É—Å–∫
                        cleaning: { time: '0', isCompleted: false, hasWork: false }, // –ü—Ä–æ–ø—É—Å–∫
                        bending: { time: '0', isCompleted: false, hasWork: false }, // –ü—Ä–æ–ø—É—Å–∫
                        welding: { time: '4', isCompleted: false, hasWork: true }, // 4 —á–∞—Å–∞
                        painting: { time: '0', isCompleted: false, hasWork: false } // –ü—Ä–æ–ø—É—Å–∫
                    }
                },
                {
                    orderNumber: 'TEST-004',
                    manager: '–ö–æ–∑–ª–æ–≤ –ö.–ö.',
                    operationType: '–¢–æ–ª—å–∫–æ —Ä–µ–∑–∫–∞',
                    shipmentDate: '2025-01-18',
                    orderStatus: '–í —Ä–∞–±–æ—Ç–µ',
                    currentStage: 'cutting',
                    priority: 'medium',
                    stages: {
                        cutting: { time: '120', isCompleted: false, hasWork: true }, // 120 –º–∏–Ω—É—Ç (2 —á–∞—Å–∞)
                        cleaning: { time: '0', isCompleted: false, hasWork: false },
                        bending: { time: '0', isCompleted: false, hasWork: false },
                        welding: { time: '0', isCompleted: false, hasWork: false },
                        painting: { time: '0', isCompleted: false, hasWork: false }
                    }
                }
            ];
            
            filteredOrders = [...orders];
            renderOrders();
            updateColumnCounts();
        }

        // –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        async function loadInitialData() {
            await loadOrdersData();
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
        function startAutoUpdate() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            autoUpdateInterval = setInterval(async () => {
                console.log('üîÑ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...');
                await loadOrdersData();
            }, 30000);
            
            console.log('‚è∞ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥)');
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  
        function getInitials(name) {
            if (!name) return '–ì–°';
            return name.split(' ')
                      .map(part => part.charAt(0))
                      .join('')
                      .toUpperCase()
                      .slice(0, 2);
        }

        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ —Å–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                if (autoUpdateInterval) {
                    clearInterval(autoUpdateInterval);
                    console.log('‚è∏Ô∏è –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
                }
            } else {
                startAutoUpdate();
                console.log('‚ñ∂Ô∏è –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–æ');
            }
        });

        // ========== –§–£–ù–ö–¶–ò–ò –†–ê–ë–û–¢–´ –° –ú–û–î–ê–õ–¨–ù–´–ú–ò –û–ö–ù–ê–ú–ò ==========

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å –¥–µ—Ç–∞–ª—è–º–∏ –∑–∞–∫–∞–∑–∞
        function openOrderDetail(order) {
            currentOrderDetail = order;
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            document.getElementById('modalOrderNumber').textContent = `–ó–∞–∫–∞–∑ ${order.orderNumber}`;
            document.getElementById('modalManager').textContent = order.manager;
            document.getElementById('modalOperationType').textContent = order.operationType;
            document.getElementById('modalShipmentDate').textContent = order.shipmentDate || '–ù–µ —É–∫–∞–∑–∞–Ω–∞';
            document.getElementById('modalPriority').textContent = getPriorityText(order.priority);
            document.getElementById('modalCurrentStage').textContent = getStageDisplayName(order.currentStage);
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–µ—Ç–∞–ª–∏ —ç—Ç–∞–ø–æ–≤
            renderModalStages(order);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            document.getElementById('orderDetailModal').classList.add('active');
            
            // –°–∫—Ä—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –ø—Ä–æ–±–ª–µ–º—ã –µ—Å–ª–∏ –±—ã–ª–∞ –æ—Ç–∫—Ä—ã—Ç–∞
            hideProblemForm();
            
            console.log('üìã –û—Ç–∫—Ä—ã—Ç–∞ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–∫–∞–∑–∞:', order.orderNumber);
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function closeOrderDetail() {
            document.getElementById('orderDetailModal').classList.remove('active');
            currentOrderDetail = null;
            hideProblemForm();
            console.log('‚ùå –ó–∞–∫—Ä—ã—Ç–∞ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–∫–∞–∑–∞');
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É —Å–æ–æ–±—â–µ–Ω–∏—è –æ –ø—Ä–æ–±–ª–µ–º–µ
        function showProblemForm() {
            const problemForm = document.getElementById('problemForm');
            problemForm.classList.add('active');
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            document.getElementById('problemDescription').value = '';
            
            console.log('‚ö†Ô∏è –û—Ç–∫—Ä—ã—Ç–∞ —Ñ–æ—Ä–º–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –ø—Ä–æ–±–ª–µ–º–µ');
        }

        // –°–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É —Å–æ–æ–±—â–µ–Ω–∏—è –æ –ø—Ä–æ–±–ª–µ–º–µ
        function hideProblemForm() {
            const problemForm = document.getElementById('problemForm');
            problemForm.classList.remove('active');
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –ø—Ä–æ–±–ª–µ–º–µ
        function submitProblem() {
            const description = document.getElementById('problemDescription').value.trim();
            
            if (!description) {
                alert('‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É');
                return;
            }
            
            if (!currentOrderDetail) {
                alert('‚ùå –û—à–∏–±–∫–∞: –∑–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const userData = JSON.parse(localStorage.getItem('weldmet_user') || '{}');
            const userName = userData.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
            
            // –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å –æ –ø—Ä–æ–±–ª–µ–º–µ
            const problemReport = {
                id: Date.now(),
                orderNumber: currentOrderDetail.orderNumber,
                reportedBy: userName,
                description: description,
                timestamp: new Date().toLocaleString('ru-RU'),
                orderStage: currentOrderDetail.currentStage,
                orderManager: currentOrderDetail.manager,
                status: 'new' // new, in-progress, resolved
            };
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            saveProblemReport(problemReport);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—à–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            alert(`‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—Ä–æ–±–ª–µ–º–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!\n\n–ó–∞–∫–∞–∑: ${currentOrderDetail.orderNumber}\n–ü—Ä–æ–±–ª–µ–º–∞ –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ –æ—Ç—á–µ—Ç—ã.`);
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            closeOrderDetail();
            
            console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—Ä–æ–±–ª–µ–º–µ:', problemReport);
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –æ –ø—Ä–æ–±–ª–µ–º–µ
        function saveProblemReport(problemReport) {
            const existingReports = JSON.parse(localStorage.getItem('weldmet_problem_reports') || '[]');
            existingReports.unshift(problemReport); // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ –º–∞—Å—Å–∏–≤–∞
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç—á–µ—Ç–æ–≤ (–º–∞–∫—Å–∏–º—É–º 100)
            if (existingReports.length > 100) {
                existingReports.splice(100);
            }
            
            localStorage.setItem('weldmet_problem_reports', JSON.stringify(existingReports));
            
            console.log(`üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω –æ—Ç—á–µ—Ç –æ –ø—Ä–æ–±–ª–µ–º–µ. –í—Å–µ–≥–æ –æ—Ç—á–µ—Ç–æ–≤: ${existingReports.length}`);
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —ç—Ç–∞–ø–æ–≤ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
        function renderModalStages(order) {
            const container = document.getElementById('modalStagesDetail');
            container.innerHTML = '';
            
            const stageOrder = ['cutting', 'cleaning', 'bending', 'welding', 'painting'];
            
            stageOrder.forEach(stageName => {
                const stage = order.stages[stageName];
                if (!stage) return;
                
                let statusClass = 'not-required';
                let statusText = '–ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è';
                
                if (stage.hasWork) {
                    if (stage.isCompleted) {
                        statusClass = 'completed';
                        statusText = '–ì–æ—Ç–æ–≤–æ';
                    } else {
                        statusClass = 'in-progress';
                        statusText = order.currentStage === stageName ? '–¢–µ–∫—É—â–∏–π —ç—Ç–∞–ø' : '–û–∂–∏–¥–∞–µ—Ç';
                    }
                }
                
                const stageElement = document.createElement('div');
                stageElement.className = 'stage-detail-item';
                stageElement.innerHTML = `
                    <div class="stage-detail-left">
                        <span>${getStageIcon(stageName)}</span>
                        <span>${getStageName(stageName)}</span>
                        ${stage.hasWork ? `<span class="stage-detail-time">(${formatStageTime(stageName, stage.time)})</span>` : ''}
                    </div>
                    <span class="stage-detail-status ${statusClass}">${statusText}</span>
                `;
                
                container.appendChild(stageElement);
            });
            
            // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
            renderMovementButtons(order);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
        function renderMovementButtons(order) {
            const container = document.getElementById('movementButtons');
            container.innerHTML = '';
            
            const allStages = [
                { key: 'cutting', name: '–†–µ–∑–∫–∞', icon: '‚úÇÔ∏è' },
                { key: 'cleaning', name: '–ó–∞—á–∏—Å—Ç–∫–∞', icon: 'üßΩ' },
                { key: 'bending', name: '–ì–∏–±–∫–∞', icon: 'üîß' },
                { key: 'welding', name: '–°–≤–∞—Ä–∫–∞', icon: 'üî•' },
                { key: 'painting', name: '–ü–æ–∫—Ä–∞—Å–∫–∞', icon: 'üé®' },
                { key: 'storage', name: '–°–∫–ª–∞–¥', icon: 'üì¶' }
            ];
            
            allStages.forEach(stage => {
                const button = document.createElement('button');
                button.className = 'movement-btn';
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
                let buttonClass = '';
                let clickable = true;
                
                if (order.currentStage === stage.key) {
                    buttonClass = 'current';
                    clickable = false;
                } else if (stage.key !== 'storage' && order.stages[stage.key] && !order.stages[stage.key].hasWork) {
                    buttonClass = 'disabled';
                    clickable = false;
                }
                
                button.className += ' ' + buttonClass;
                button.innerHTML = `${stage.icon} ${stage.name}`;
                
                if (clickable) {
                    button.addEventListener('click', () => {
                        moveOrderToStage(order, stage.key, stage.name);
                    });
                }
                
                container.appendChild(button);
            });
        }

        // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –Ω–∞ –¥—Ä—É–≥–æ–π —ç—Ç–∞–ø
        function moveOrderToStage(order, newStage, stageName) {
            showMovementConfirmationModal(order, newStage, stageName);
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
        function showMovementConfirmationModal(order, newStage, stageName) {
            // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            const confirmModal = document.createElement('div');
            confirmModal.className = 'movement-confirm-modal';
            confirmModal.innerHTML = `
                <div class="movement-confirm-content">
                    <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è</h3>
                    <p>–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –∑–∞–∫–∞–∑ <strong>${order.orderNumber}</strong> –Ω–∞ —ç—Ç–∞–ø <strong>"${stageName}"</strong>?</p>
                    
                    <div class="comment-section">
                        <p style="margin: 15px 0 10px 0; font-weight: 500;">–ß—Ç–æ-—Ç–æ —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å?</p>
                        <div class="comment-buttons">
                            <button type="button" class="comment-btn yes-btn" onclick="showCommentInput()">–î–∞</button>
                            <button type="button" class="comment-btn no-btn" onclick="hideCommentInput()">–ù–µ—Ç</button>
                        </div>
                        <div class="comment-input-section" style="display: none; margin-top: 15px;">
                            <textarea id="movementComment" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." rows="3"></textarea>
                        </div>
                    </div>
                    
                    <div class="confirm-buttons">
                        <button type="button" class="confirm-btn cancel" onclick="closeMovementConfirm()">–û—Ç–º–µ–Ω–∞</button>
                        <button type="button" class="confirm-btn confirm" onclick="executeMovement()">–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å</button>
                    </div>
                </div>
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            if (!document.querySelector('#movementConfirmStyles')) {
                const style = document.createElement('style');
                style.id = 'movementConfirmStyles';
                style.textContent = `
                    .movement-confirm-modal {
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(0, 0, 0, 0.7);
                        z-index: 2000;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        padding: 20px;
                    }
                    
                    .movement-confirm-content {
                        background: white;
                        border-radius: 15px;
                        padding: 25px;
                        max-width: 400px;
                        width: 100%;
                        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                    }
                    
                    .movement-confirm-content h3 {
                        margin: 0 0 15px 0;
                        color: #2c3e50;
                        text-align: center;
                    }
                    
                    .movement-confirm-content p {
                        color: #555;
                        line-height: 1.5;
                        text-align: center;
                    }
                    
                    .comment-section {
                        margin: 20px 0;
                        padding: 15px;
                        background: #f8f9fa;
                        border-radius: 10px;
                    }
                    
                    .comment-buttons {
                        display: flex;
                        gap: 10px;
                        justify-content: center;
                    }
                    
                    .comment-btn {
                        padding: 8px 20px;
                        border: none;
                        border-radius: 20px;
                        cursor: pointer;
                        font-weight: 500;
                        transition: all 0.3s ease;
                    }
                    
                    .yes-btn {
                        background: #28a745;
                        color: white;
                    }
                    
                    .yes-btn:hover {
                        background: #218838;
                    }
                    
                    .no-btn {
                        background: #6c757d;
                        color: white;
                    }
                    
                    .no-btn:hover {
                        background: #5a6268;
                    }
                    
                    .comment-input-section textarea {
                        width: 100%;
                        padding: 10px;
                        border: 2px solid #ddd;
                        border-radius: 8px;
                        resize: vertical;
                        font-family: inherit;
                    }
                    
                    .comment-input-section textarea:focus {
                        outline: none;
                        border-color: #007bff;
                    }
                    
                    .confirm-buttons {
                        display: flex;
                        gap: 10px;
                        justify-content: center;
                        margin-top: 20px;
                    }
                    
                    .confirm-btn {
                        padding: 12px 25px;
                        border: none;
                        border-radius: 25px;
                        cursor: pointer;
                        font-weight: 600;
                        transition: all 0.3s ease;
                    }
                    
                    .confirm-btn.cancel {
                        background: #dc3545;
                        color: white;
                    }
                    
                    .confirm-btn.cancel:hover {
                        background: #c82333;
                    }
                    
                    .confirm-btn.confirm {
                        background: #28a745;
                        color: white;
                    }
                    
                    .confirm-btn.confirm:hover {
                        background: #218838;
                    }
                `;
                document.head.appendChild(style);
            }
            
            document.body.appendChild(confirmModal);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
            window.pendingMovement = { order, newStage, stageName };
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–µ –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
        function showCommentInput() {
            document.querySelector('.comment-input-section').style.display = 'block';
            document.querySelector('.yes-btn').style.background = '#218838';
            document.querySelector('.no-btn').style.background = '#6c757d';
        }
        
        // –°–∫—Ä—ã—Ç—å –ø–æ–ª–µ –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
        function hideCommentInput() {
            document.querySelector('.comment-input-section').style.display = 'none';
            document.querySelector('#movementComment').value = '';
            document.querySelector('.yes-btn').style.background = '#28a745';
            document.querySelector('.no-btn').style.background = '#5a6268';
        }
        
        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        function closeMovementConfirm() {
            const modal = document.querySelector('.movement-confirm-modal');
            if (modal) {
                modal.remove();
            }
            window.pendingMovement = null;
        }
        
        // –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
        function executeMovement() {
            const movement = window.pendingMovement;
            if (!movement) return;
            
            const { order, newStage, stageName } = movement;
            const comment = document.querySelector('#movementComment')?.value.trim() || '';
            
            const userData = JSON.parse(localStorage.getItem('weldmet_user') || '{}');
            const userName = userData.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
            
            // –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å –æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏
            const movementLog = {
                id: Date.now(),
                orderNumber: order.orderNumber,
                fromStage: order.currentStage,
                toStage: newStage,
                fromStageName: getStageDisplayName(order.currentStage),
                toStageName: getStageDisplayName(newStage),
                movedBy: userName,
                timestamp: new Date().toLocaleString('ru-RU'),
                orderManager: order.manager,
                operationType: order.operationType,
                comment: comment // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
            };
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            saveMovementLog(movementLog);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π —ç—Ç–∞–ø –∑–∞–∫–∞–∑–∞ –≤ –ø–∞–º—è—Ç–∏
            const orderIndex = orders.findIndex(o => o.orderNumber === order.orderNumber);
            if (orderIndex !== -1) {
                orders[orderIndex].currentStage = newStage;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º filteredOrders –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                const filteredIndex = filteredOrders.findIndex(o => o.orderNumber === order.orderNumber);
                if (filteredIndex !== -1) {
                    filteredOrders[filteredIndex].currentStage = newStage;
                }
                
                // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∑–∞–∫–∞–∑—ã
                renderOrders();
                updateColumnCounts();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                currentOrderDetail.currentStage = newStage;
                document.getElementById('modalCurrentStage').textContent = getStageDisplayName(newStage);
                renderMovementButtons(currentOrderDetail);
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const commentText = comment ? ` (–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: "${comment}")` : '';
            alert(`‚úÖ –ó–∞–∫–∞–∑ ${order.orderNumber} –ø–µ—Ä–µ–º–µ—â–µ–Ω –Ω–∞ —ç—Ç–∞–ø "${stageName}"${commentText}`);
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            closeMovementConfirm();
            
            console.log('üì¶ –ó–∞–∫–∞–∑ –ø–µ—Ä–µ–º–µ—â–µ–Ω:', movementLog);
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–≥–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
        function saveMovementLog(movementLog) {
            const existingLogs = JSON.parse(localStorage.getItem('weldmet_movement_logs') || '[]');
            existingLogs.unshift(movementLog); // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ –º–∞—Å—Å–∏–≤–∞
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–æ–≥–æ–≤ (–º–∞–∫—Å–∏–º—É–º 500)
            if (existingLogs.length > 500) {
                existingLogs.splice(500);
            }
            
            localStorage.setItem('weldmet_movement_logs', JSON.stringify(existingLogs));
            
            console.log(`üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω –ª–æ–≥ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è. –í—Å–µ–≥–æ –ª–æ–≥–æ–≤: ${existingLogs.length}`);
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
        function getPriorityText(priority) {
            const priorityTexts = {
                'high': 'üî¥ –í—ã—Å–æ–∫–∏–π',
                'medium': 'üü° –°—Ä–µ–¥–Ω–∏–π', 
                'low': 'üü¢ –ù–∏–∑–∫–∏–π'
            };
            return priorityTexts[priority] || 'üü° –°—Ä–µ–¥–Ω–∏–π';
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —ç—Ç–∞–ø–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function getStageDisplayName(stage) {
            const names = {
                all: 'üìã –í—Å–µ –∑–∞–∫–∞–∑—ã',
                cutting: '‚úÇÔ∏è –†–µ–∑–∫–∞',
                cleaning: 'üßΩ –ó–∞—á–∏—Å—Ç–∫–∞/—Ç—Ä–∞–≤–ª–µ–Ω–∏–µ',
                bending: 'üîß –ì–∏–±–∫–∞',
                welding: 'üî• –°–≤–∞—Ä–∫–∞',
                painting: 'üé® –ü–æ–∫—Ä–∞—Å–∫–∞',
                storage: 'üì¶ –°–∫–ª–∞–¥'
            };
            return names[stage] || stage;
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        document.getElementById('orderDetailModal').addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-overlay')) {
                closeOrderDetail();
            }
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && currentOrderDetail) {
                closeOrderDetail();
            }
        });
    </script>
</body>
</html>