<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—á–µ—Ç–æ–≤</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f0f0f0;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .info {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 10px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .log {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-line;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
        }
    </style>
</head>
<body>
    <h1>üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –æ—Ç—á–µ—Ç–æ–≤</h1>
    
    <div class="info">
        <p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–º–æ–∂–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –≤–∫–ª–∞–¥–∫–æ–π "–ü—Ä–æ–±–ª–µ–º—ã" –≤ –æ—Ç—á–µ—Ç–∞—Ö.</p>
    </div>

    <button class="btn" onclick="runFullTest()">üß™ –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç</button>
    <button class="btn" onclick="createTestData()">üìù –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
    <button class="btn" onclick="checkLocalStorage()">üíæ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å localStorage</button>
    <button class="btn" onclick="openReports()">üìä –û—Ç–∫—Ä—ã—Ç—å –æ—Ç—á–µ—Ç—ã</button>

    <div id="result"></div>
    <div id="log"></div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.textContent += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function createTestData() {
            log('–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö...');
            
            const testOrders = [
                {
                    id: "test-order-1",
                    number: "TEST-001",
                    client: "–¢–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç 1",
                    manager: "–¢–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç 1", 
                    product: "–ú–µ—Ç–∞–ª–ª–æ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è",
                    operationType: "–ú–µ—Ç–∞–ª–ª–æ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è",
                    date: "2025-01-10",
                    currentSection: "cutting",
                    history: [
                        {
                            section: "cutting",
                            timestamp: "2025-01-10T10:00:00.000Z"
                        }
                    ],
                    issues: [
                        {
                            id: "issue-1",
                            description: "–¢–µ—Å—Ç–æ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞ 1: –ù–µ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª",
                            user: "–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
                            timestamp: "2025-01-10T14:30:00.000Z",
                            resolved: false
                        },
                        {
                            id: "issue-2",
                            description: "–¢–µ—Å—Ç–æ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞ 2: –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–æ—Å—Ç–∞–≤–∫–∏ (—Ä–µ—à–µ–Ω–æ)",
                            user: "–ú–µ–Ω–µ–¥–∂–µ—Ä",
                            timestamp: "2025-01-11T09:15:00.000Z",
                            resolved: true
                        }
                    ]
                },
                {
                    id: "test-order-2", 
                    number: "TEST-002",
                    client: "–¢–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç 2",
                    manager: "–¢–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç 2",
                    product: "–°–≤–∞—Ä–æ—á–Ω—ã–µ —Ä–∞–±–æ—Ç—ã",
                    operationType: "–°–≤–∞—Ä–æ—á–Ω—ã–µ —Ä–∞–±–æ—Ç—ã", 
                    date: "2025-01-12",
                    currentSection: "welding",
                    history: [
                        {
                            section: "cutting",
                            timestamp: "2025-01-12T10:00:00.000Z"
                        },
                        {
                            section: "welding", 
                            timestamp: "2025-01-13T08:00:00.000Z"
                        }
                    ],
                    issues: [
                        {
                            id: "issue-3",
                            description: "–¢–µ—Å—Ç–æ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞ 3: –ü—Ä–æ–±–ª–µ–º–∞ —Å –∫–∞—á–µ—Å—Ç–≤–æ–º —Å–≤–∞—Ä–∫–∏",
                            user: "–°–≤–∞—Ä—â–∏–∫ –ò–≤–∞–Ω–æ–≤",
                            timestamp: "2025-01-13T16:20:00.000Z",
                            resolved: false
                        }
                    ]
                }
            ];

            localStorage.setItem('ordersData', JSON.stringify(testOrders));
            
            if (!localStorage.getItem('userProfile')) {
                const testProfile = {
                    name: "–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
                    role: "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä", 
                    loginTime: new Date().toISOString()
                };
                localStorage.setItem('userProfile', JSON.stringify(testProfile));
                log('–°–æ–∑–¥–∞–Ω –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
            }

            log(`–°–æ–∑–¥–∞–Ω–æ ${testOrders.length} —Ç–µ—Å—Ç–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤ —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏`);
            
            const totalIssues = testOrders.reduce((total, order) => 
                total + (order.issues ? order.issues.length : 0), 0);
            log(`–í—Å–µ–≥–æ –ø—Ä–æ–±–ª–µ–º: ${totalIssues}`);
            
            document.getElementById('result').innerHTML = `
                <div class="info success">
                    <h3>‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞–Ω—ã!</h3>
                    <p>–°–æ–∑–¥–∞–Ω–æ ${testOrders.length} –∑–∞–∫–∞–∑–æ–≤ —Å ${totalIssues} –ø—Ä–æ–±–ª–µ–º–∞–º–∏</p>
                </div>
            `;
        }

        function checkLocalStorage() {
            log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ localStorage...');
            
            const ordersData = localStorage.getItem('ordersData');
            const userProfile = localStorage.getItem('userProfile');
            
            let resultHTML = '<div class="info"><h3>üìä –°–æ—Å—Ç–æ—è–Ω–∏–µ localStorage:</h3>';
            
            if (ordersData) {
                const orders = JSON.parse(ordersData);
                const totalIssues = orders.reduce((total, order) => {
                    const issuesCount = order.issues ? order.issues.length : 0;
                    log(`–ó–∞–∫–∞–∑ ${order.number}: ${issuesCount} –ø—Ä–æ–±–ª–µ–º`);
                    return total + issuesCount;
                }, 0);
                
                const activeIssues = orders.reduce((total, order) => {
                    if (!order.issues) return total;
                    return total + order.issues.filter(issue => !issue.resolved).length;
                }, 0);
                
                resultHTML += `
                    <p>‚úÖ <strong>–ó–∞–∫–∞–∑—ã:</strong> ${orders.length}</p>
                    <p>‚úÖ <strong>–í—Å–µ–≥–æ –ø—Ä–æ–±–ª–µ–º:</strong> ${totalIssues}</p>
                    <p>‚úÖ <strong>–ê–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º:</strong> ${activeIssues}</p>
                `;
                log(`–ù–∞–π–¥–µ–Ω–æ ${orders.length} –∑–∞–∫–∞–∑–æ–≤ —Å ${totalIssues} –ø—Ä–æ–±–ª–µ–º–∞–º–∏ (${activeIssues} –∞–∫—Ç–∏–≤–Ω—ã—Ö)`);
            } else {
                resultHTML += '<p>‚ùå <strong>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞–∫–∞–∑–∞—Ö</strong></p>';
                log('–û–®–ò–ë–ö–ê: –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞–∫–∞–∑–∞—Ö –≤ localStorage');
            }
            
            if (userProfile) {
                const profile = JSON.parse(userProfile);
                resultHTML += `<p>‚úÖ <strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> ${profile.name}</p>`;
                log(`–ù–∞–π–¥–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${profile.name}`);
            } else {
                resultHTML += '<p>‚ùå <strong>–ù–µ—Ç –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</strong></p>';
                log('–û–®–ò–ë–ö–ê: –ù–µ—Ç –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
            }
            
            resultHTML += '</div>';
            document.getElementById('result').innerHTML = resultHTML;
        }

        function openReports() {
            log('–û—Ç–∫—Ä—ã—Ç–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ—Ç—á–µ—Ç–æ–≤...');
            const newWindow = window.open('reports.html', '_blank');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥, –æ—Ç–∫—Ä—ã–ª–∞—Å—å –ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞
            setTimeout(() => {
                if (newWindow && !newWindow.closed) {
                    log('‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç—á–µ—Ç–æ–≤ –æ—Ç–∫—Ä—ã—Ç–∞');
                    document.getElementById('result').innerHTML = `
                        <div class="info success">
                            <h3>üìä –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç—á–µ—Ç–æ–≤ –æ—Ç–∫—Ä—ã—Ç–∞</h3>
                            <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∫–ª–∞–¥–∫—É "‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã" –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ</p>
                            <p>–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (F12) –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</p>
                        </div>
                    `;
                } else {
                    log('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ—Ç—á–µ—Ç–æ–≤');
                    document.getElementById('result').innerHTML = `
                        <div class="info error">
                            <h3>‚ùå –û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –æ—Ç—á–µ—Ç–æ–≤</h3>
                            <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å <a href="reports.html" target="_blank">reports.html</a> –≤—Ä—É—á–Ω—É—é</p>
                        </div>
                    `;
                }
            }, 1000);
        }

        async function runFullTest() {
            log('=== –ó–ê–ü–£–°–ö –ü–û–õ–ù–û–ì–û –¢–ï–°–¢–ê ===');
            document.getElementById('result').innerHTML = `
                <div class="info warning">
                    <h3>üß™ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç...</h3>
                    <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∫–ª–∞–¥–∫—É "–ü—Ä–æ–±–ª–µ–º—ã" –≤ –æ—Ç—á–µ—Ç–∞—Ö</p>
                </div>
            `;
            
            // –®–∞–≥ 1: –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
            log('–®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö');
            createTestData();
            
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage
            log('–®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ localStorage');
            checkLocalStorage();
            
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // –®–∞–≥ 3: –û—Ç–∫—Ä—ã–≤–∞–µ–º –æ—Ç—á–µ—Ç—ã
            log('–®–∞–≥ 3: –û—Ç–∫—Ä—ã—Ç–∏–µ –æ—Ç—á–µ—Ç–æ–≤');
            openReports();
            
            log('=== –¢–ï–°–¢ –ó–ê–í–ï–†–®–ï–ù ===');
            log('–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:');
            log('1. –í –Ω–æ–≤–æ–º –æ–∫–Ω–µ –æ—Ç–∫—Ä–æ–π—Ç–µ –æ—Ç—á–µ—Ç—ã');
            log('2. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã"');
            log('3. –î–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è —Ç–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã');
            log('4. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12) –¥–ª—è –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.getElementById('log').innerHTML = '';
        log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç—á–µ—Ç–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
        checkLocalStorage();
    </script>
</body>
</html>
