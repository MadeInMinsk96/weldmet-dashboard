<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç—á–µ—Ç—ã - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-decoration: none;
            padding: 12px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .reports-grid {
            display: grid;
            gap: 20px;
        }

        .report-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
            transition: all 0.3s ease;
        }

        .report-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.15);
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f2f6;
        }

        .order-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .order-date {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .order-info {
            margin-bottom: 20px;
        }

        .info-row {
            display: flex;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .info-label {
            font-weight: 600;
            color: #34495e;
            width: 120px;
            flex-shrink: 0;
        }

        .info-value {
            color: #2c3e50;
        }

        .current-status {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .status-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .progress-container {
            margin-bottom: 15px;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            height: 100%;
            background: white;
            border-radius: 6px;
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .logistics-chain {
            margin-top: 20px;
        }

        .chain-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chain-item {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .chain-item.completed {
            background: #d5f4e6;
            color: #27ae60;
            border-left: 4px solid #27ae60;
        }

        .chain-item.current {
            background: #fef9e7;
            color: #f39c12;
            border-left: 4px solid #f39c12;
            font-weight: 600;
        }

        .chain-item.pending {
            background: #f8f9fa;
            color: #7f8c8d;
            border-left: 4px solid #ecf0f1;
        }

        .chain-icon {
            margin-right: 10px;
            font-size: 1.1rem;
            width: 20px;
            text-align: center;
        }

        .chain-text {
            flex: 1;
        }

        .chain-time {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-left: 10px;
        }

        .empty-reports {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 60px 20px;
            text-align: center;
            color: #7f8c8d;
        }

        .empty-reports .icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-reports .text {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .empty-reports .subtext {
            font-size: 1rem;
            opacity: 0.7;
        }

        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .stat-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .report-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .info-row {
                flex-direction: column;
                gap: 5px;
            }
            
            .info-label {
                width: auto;
            }
        }
    </style>
</head>
<body>
    <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const userData = localStorage.getItem('userProfile') || sessionStorage.getItem('userProfile');
            if (!userData) {
                window.location.href = 'auth.html';
                return;
            }
            loadReports();
        });
    </script>

    <div class="container">
        <a href="mobile_order_dashboard.html" class="back-btn">
            ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –¥–∞—à–±–æ—Ä–¥—É
        </a>
        
        <div class="header">
            <h1>üìä –û—Ç—á–µ—Ç—ã –ø–æ –∑–∞–∫–∞–∑–∞–º</h1>
            <p>–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–≤–∏–∂–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–æ–≤ –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–º —É—á–∞—Å—Ç–∫–∞–º</p>
        </div>

        <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="stats-overview" id="statsOverview"></div>

        <!-- –û—Ç—á–µ—Ç—ã –ø–æ –∑–∞–∫–∞–∑–∞–º -->
        <div class="reports-grid" id="reportsContainer"></div>
    </div>

    <script>
        // –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏
        const SECTIONS = {
            cutting: { name: '–†–µ–∑–∫–∞', icon: 'üî™', order: 1 },
            cleaning: { name: '–ó–∞—á–∏—Å—Ç–∫–∞/–¢—Ä–∞–≤–ª–µ–Ω–∏–µ', icon: 'üßπ', order: 2 },
            welding: { name: '–°–≤–∞—Ä–∫–∞', icon: '‚ö°', order: 3 },
            painting: { name: '–ü–æ–∫—Ä–∞—Å–∫–∞', icon: 'üé®', order: 4 },
            warehouse: { name: '–°–∫–ª–∞–¥', icon: 'üì¶', order: 5 },
            shipped: { name: '–û—Ç–≥—Ä—É–∂–µ–Ω–æ', icon: 'üöõ', order: 6 }
        };

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –∏–∑ localStorage
        function getOrdersFromStorage() {
            const ordersData = localStorage.getItem('ordersData');
            return ordersData ? JSON.parse(ordersData) : [];
        }

        // –†–∞—Å—á–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–∫–∞–∑–∞
        function calculateOrderProgress(order) {
            if (!order.currentSection) return 0;
            
            const sectionOrder = SECTIONS[order.currentSection].order;
            const totalSections = Object.keys(SECTIONS).length;
            
            return Math.round((sectionOrder / totalSections) * 100);
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
        function formatDateTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleDateString('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç—á–µ—Ç–æ–≤
        function loadReports() {
            const orders = getOrdersFromStorage();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            showStatistics(orders);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ç—á–µ—Ç—ã –ø–æ –∑–∞–∫–∞–∑–∞–º
            showOrderReports(orders);
        }

        // –ü–æ–∫–∞–∑ –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function showStatistics(orders) {
            const stats = {
                total: orders.length,
                inProgress: orders.filter(o => o.currentSection && o.currentSection !== 'shipped').length,
                completed: orders.filter(o => o.currentSection === 'shipped').length,
                new: orders.filter(o => !o.currentSection).length
            };

            const statsHTML = `
                <div class="stat-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-number">${stats.total}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚öôÔ∏è</div>
                    <div class="stat-number">${stats.inProgress}</div>
                    <div class="stat-label">–í –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-number">${stats.completed}</div>
                    <div class="stat-label">–û—Ç–≥—Ä—É–∂–µ–Ω–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìã</div>
                    <div class="stat-number">${stats.new}</div>
                    <div class="stat-label">–ù–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã</div>
                </div>
            `;

            document.getElementById('statsOverview').innerHTML = statsHTML;
        }

        // –ü–æ–∫–∞–∑ –æ—Ç—á–µ—Ç–æ–≤ –ø–æ –∑–∞–∫–∞–∑–∞–º
        function showOrderReports(orders) {
            const reportsContainer = document.getElementById('reportsContainer');
            
            if (orders.length === 0) {
                reportsContainer.innerHTML = `
                    <div class="empty-reports">
                        <div class="icon">üìã</div>
                        <div class="text">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è –æ—Ç—á–µ—Ç–∞</div>
                        <div class="subtext">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑ –≤ –¥–∞—à–±–æ—Ä–¥–µ</div>
                    </div>
                `;
                return;
            }

            let reportsHTML = '';
            
            orders.forEach(order => {
                const progress = calculateOrderProgress(order);
                const currentSectionName = order.currentSection ? SECTIONS[order.currentSection].name : '–ù–æ–≤—ã–π –∑–∞–∫–∞–∑';
                
                reportsHTML += `
                    <div class="report-card">
                        <div class="report-header">
                            <div class="order-title">
                                üì¶ ${order.number} - ${order.product}
                            </div>
                            <div class="order-date">${formatDate(order.date)}</div>
                        </div>
                        
                        <div class="order-info">
                            <div class="info-row">
                                <span class="info-label">–ö–ª–∏–µ–Ω—Ç:</span>
                                <span class="info-value">${order.client}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">–¢–æ–≤–∞—Ä:</span>
                                <span class="info-value">${order.product}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞:</span>
                                <span class="info-value">${formatDate(order.date)}</span>
                            </div>
                        </div>
                        
                        <div class="current-status">
                            <div class="status-title">–¢–µ–∫—É—â–∏–π —É—á–∞—Å—Ç–æ–∫: ${currentSectionName}</div>
                            <div class="progress-container">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${progress}%"></div>
                                </div>
                                <div class="progress-text">${progress}% –∑–∞–≤–µ—Ä—à–µ–Ω–æ</div>
                            </div>
                        </div>
                        
                        <div class="logistics-chain">
                            <div class="chain-title">
                                üîÑ –¶–µ–ø–æ—á–∫–∞ –ª–æ–≥–∏—Å—Ç–∏–∫–∏
                            </div>
                            ${generateLogisticsChain(order)}
                        </div>
                    </div>
                `;
            });
            
            reportsContainer.innerHTML = reportsHTML;
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ü–µ–ø–æ—á–∫–∏ –ª–æ–≥–∏—Å—Ç–∏–∫–∏
        function generateLogisticsChain(order) {
            let chainHTML = '';
            const sectionKeys = Object.keys(SECTIONS);
            
            sectionKeys.forEach(sectionKey => {
                const section = SECTIONS[sectionKey];
                const historyItem = order.history.find(h => h.section === sectionKey);
                
                if (historyItem) {
                    const isCurrentSection = order.currentSection === sectionKey;
                    const className = isCurrentSection ? 'current' : 'completed';
                    const icon = isCurrentSection ? 'üü°' : '‚úÖ';
                    const statusText = isCurrentSection ? ' - —Ç–µ–∫—É—â–∏–π' : '';
                    const timeText = formatDateTime(historyItem.timestamp);
                    
                    chainHTML += `
                        <div class="chain-item ${className}">
                            <span class="chain-icon">${icon}</span>
                            <span class="chain-text">–ü–µ—Ä–µ–º–µ—â–µ–Ω –Ω–∞ ${section.name}${statusText}</span>
                            <span class="chain-time">${timeText}</span>
                        </div>
                    `;
                } else {
                    chainHTML += `
                        <div class="chain-item pending">
                            <span class="chain-icon">‚ö™</span>
                            <span class="chain-text">${section.name}</span>
                            <span class="chain-time">–û–∂–∏–¥–∞–Ω–∏–µ</span>
                        </div>
                    `;
                }
            });
            
            return chainHTML;
        }
    </script>
</body>
</html>