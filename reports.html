<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç—á–µ—Ç—ã - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-decoration: none;
            padding: 12px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .reports-grid {
            display: grid;
            gap: 20px;
        }

        .report-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
            transition: all 0.3s ease;
        }

        .report-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.15);
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f2f6;
        }

        .order-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .order-date {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .order-info {
            margin-bottom: 20px;
        }

        .info-row {
            display: flex;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .info-label {
            font-weight: 600;
            color: #34495e;
            width: 120px;
            flex-shrink: 0;
        }

        .info-value {
            color: #2c3e50;
        }

        .current-status {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .status-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .progress-container {
            margin-bottom: 15px;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            height: 100%;
            background: white;
            border-radius: 6px;
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .logistics-chain {
            margin-top: 20px;
        }

        .chain-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chain-item {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .chain-item.completed {
            background: #d5f4e6;
            color: #27ae60;
            border-left: 4px solid #27ae60;
        }

        .chain-item.current {
            background: #fef9e7;
            color: #f39c12;
            border-left: 4px solid #f39c12;
            font-weight: 600;
        }

        .chain-item.pending {
            background: #f8f9fa;
            color: #7f8c8d;
            border-left: 4px solid #ecf0f1;
        }

        .chain-icon {
            margin-right: 10px;
            font-size: 1.1rem;
            width: 20px;
            text-align: center;
        }

        .chain-text {
            flex: 1;
        }

        .chain-time {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-left: 10px;
        }

        .empty-reports {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 60px 20px;
            text-align: center;
            color: #7f8c8d;
        }

        .empty-reports .icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-reports .text {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .empty-reports .subtext {
            font-size: 1rem;
            opacity: 0.7;
        }

        /* –ü–æ–∏—Å–∫ –≤ –æ—Ç—á–µ—Ç–∞—Ö */
        .search-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .search-input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .search-input-container {
            position: relative;
        }
        
        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #7f8c8d;
            font-size: 18px;
            pointer-events: none;
        }
        
        .clear-search {
            position: absolute;
            right: 50px;
            top: 50%;
            transform: translateY(-50%);
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 14px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
        }

        /* –í–∫–ª–∞–¥–∫–∏ –æ—Ç—á–µ—Ç–æ–≤ */
        .report-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        
        .report-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            border-radius: 10px;
            background: transparent;
            border: none;
            font-size: 14px;
            font-weight: 600;
            color: #7f8c8d;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: 120px;
        }
        
        .report-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 10px rgba(102, 126, 234, 0.3);
        }
        
        /* –†–∞–∑–¥–µ–ª –ø—Ä–æ–±–ª–µ–º */
        .issues-section {
            margin-bottom: 30px;
        }
        
        .issue-item {
            background: #fff5f5;
            border: 1px solid #fed7d7;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid #e53e3e;
        }
        
        .issue-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .issue-order {
            font-weight: 600;
            color: #e53e3e;
            font-size: 16px;
        }
        
        .issue-date {
            color: #7f8c8d;
            font-size: 12px;
        }
        
        .issue-description {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #fed7d7;
        }
        
        .issue-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #7f8c8d;
            flex-wrap: wrap;
            gap: 10px;
        }

        .issue-order-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .issue-order-btn:hover {
            background: #2980b9;
        }

        /* –°—á–µ—Ç—á–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º */
        .issues-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .issue-stat-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 4px solid #e74c3c;
        }
        
        .issue-stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #e74c3c;
            margin-bottom: 5px;
        }
        
        .issue-stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .stat-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .report-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .info-row {
                flex-direction: column;
                gap: 5px;
            }
            
            .info-label {
                width: auto;
            }
        }
    </style>
</head>
<body>
    <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const userData = localStorage.getItem('userProfile') || sessionStorage.getItem('userProfile');
            if (!userData) {
                window.location.href = 'auth.html';
                return;
            }
            loadReports();
        });
    </script>

    <div class="container">
        <a href="mobile_order_dashboard.html" class="back-btn">
            ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –¥–∞—à–±–æ—Ä–¥—É
        </a>
        
        <div class="header">
            <h1>üìä –û—Ç—á–µ—Ç—ã –ø–æ –∑–∞–∫–∞–∑–∞–º</h1>
            <p>–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–≤–∏–∂–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–æ–≤ –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–º —É—á–∞—Å—Ç–∫–∞–º</p>
        </div>

        <!-- –ü–æ–∏—Å–∫ –ø–æ –æ—Ç—á–µ—Ç–∞–º -->
        <div class="search-container">
            <div class="search-input-container">
                <input type="text" id="searchInput" class="search-input" placeholder="üîç –ü–æ–∏—Å–∫ –≤ –æ—Ç—á–µ—Ç–∞—Ö –ø–æ –Ω–æ–º–µ—Ä—É –∑–∞–∫–∞–∑–∞, –∫–ª–∏–µ–Ω—Ç—É –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º–µ...">
                <button class="clear-search" id="clearSearch" onclick="clearSearch()">√ó</button>
                <span class="search-icon">üîç</span>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∏ –æ—Ç—á–µ—Ç–æ–≤ -->
        <div class="report-tabs">
            <button class="report-tab active" onclick="showReportTab('orders')">üìä –í—Å–µ –∑–∞–∫–∞–∑—ã</button>
            <button class="report-tab" onclick="showReportTab('issues')">‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã</button>
            <button class="report-tab" onclick="showReportTab('analytics')">üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
        </div>

        <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="stats-overview" id="statsOverview"></div>

        <!-- –†–∞–∑–¥–µ–ª –∑–∞–∫–∞–∑–æ–≤ -->
        <div id="ordersSection" class="report-section">
            <div class="reports-grid" id="reportsContainer"></div>
        </div>

        <!-- –†–∞–∑–¥–µ–ª –ø—Ä–æ–±–ª–µ–º -->
        <div id="issuesSection" class="report-section" style="display: none;">
            <div class="issues-stats" id="issuesStats"></div>
            <div class="issues-section" id="issuesContainer"></div>
        </div>

        <!-- –†–∞–∑–¥–µ–ª –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ -->
        <div id="analyticsSection" class="report-section" style="display: none;">
            <div id="analyticsContainer"></div>
        </div>
    </div>

    <script>
        // –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏
        const SECTIONS = {
            cutting: { name: '–†–µ–∑–∫–∞', icon: 'üî™', order: 1 },
            cleaning: { name: '–ó–∞—á–∏—Å—Ç–∫–∞/–¢—Ä–∞–≤–ª–µ–Ω–∏–µ', icon: 'üßπ', order: 2 },
            welding: { name: '–°–≤–∞—Ä–∫–∞', icon: '‚ö°', order: 3 },
            painting: { name: '–ü–æ–∫—Ä–∞—Å–∫–∞', icon: 'üé®', order: 4 },
            warehouse: { name: '–°–∫–ª–∞–¥', icon: 'üì¶', order: 5 },
            shipped: { name: '–û—Ç–≥—Ä—É–∂–µ–Ω–æ', icon: 'üöõ', order: 6 }
        };

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let searchFilter = '';
        let currentTab = 'orders';
        let allOrders = [];

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –∏–∑ localStorage
        function getOrdersFromStorage() {
            const ordersData = localStorage.getItem('ordersData');
            return ordersData ? JSON.parse(ordersData) : [];
        }

        // –†–∞—Å—á–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–∫–∞–∑–∞
        function calculateOrderProgress(order) {
            if (!order.currentSection) return 0;
            
            const sectionOrder = SECTIONS[order.currentSection].order;
            const totalSections = Object.keys(SECTIONS).length;
            
            return Math.round((sectionOrder / totalSections) * 100);
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
        function formatDateTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleDateString('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç—á–µ—Ç–æ–≤
        function loadReports() {
            allOrders = getOrdersFromStorage();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ–∏—Å–∫
            initializeSearch();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            showStatistics(allOrders);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –≤–∫–ª–∞–¥–∫—É
            showCurrentTab();
        }

        // === –°–ò–°–¢–ï–ú–ê –ü–û–ò–°–ö–ê ===
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞
        function initializeSearch() {
            const searchInput = document.getElementById('searchInput');
            const clearBtn = document.getElementById('clearSearch');
            
            searchInput.addEventListener('input', function(e) {
                searchFilter = e.target.value.toLowerCase().trim();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –æ—á–∏—Å—Ç–∫–∏
                if (searchFilter) {
                    clearBtn.style.display = 'flex';
                } else {
                    clearBtn.style.display = 'none';
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –≤–∫–ª–∞–¥–∫—É —Å —Ñ–∏–ª—å—Ç—Ä–æ–º
                showCurrentTab();
            });
        }
        
        // –û—á–∏—Å—Ç–∫–∞ –ø–æ–∏—Å–∫–∞
        function clearSearch() {
            const searchInput = document.getElementById('searchInput');
            const clearBtn = document.getElementById('clearSearch');
            
            searchInput.value = '';
            searchFilter = '';
            clearBtn.style.display = 'none';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –≤–∫–ª–∞–¥–∫—É
            showCurrentTab();
        }
        
        // === –£–ü–†–ê–í–õ–ï–ù–ò–ï –í–ö–õ–ê–î–ö–ê–ú–ò ===
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function showReportTab(tabName) {
            console.log('–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É:', tabName);
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å —Ç–∞–±–æ–≤
            document.querySelectorAll('.report-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏
            document.querySelectorAll('.report-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            const targetTab = document.querySelector(`[onclick="showReportTab('${tabName}')"]`);
            const targetSection = document.getElementById(tabName + 'Section');
            
            console.log('–ù–∞–π–¥–µ–Ω–∞ –≤–∫–ª–∞–¥–∫–∞:', targetTab);
            console.log('–ù–∞–π–¥–µ–Ω–∞ —Å–µ–∫—Ü–∏—è:', targetSection);
            
            if (targetTab) targetTab.classList.add('active');
            if (targetSection) targetSection.style.display = 'block';
            
            currentTab = tabName;
            showCurrentTab();
        }
        
        // –ü–æ–∫–∞–∑ —Ç–µ–∫—É—â–µ–π –≤–∫–ª–∞–¥–∫–∏
        function showCurrentTab() {
            const filteredOrders = filterOrders(allOrders);
            
            switch (currentTab) {
                case 'orders':
                    showOrderReports(filteredOrders);
                    break;
                case 'issues':
                    showIssuesReports(filteredOrders);
                    break;
                case 'analytics':
                    showAnalytics(filteredOrders);
                    break;
            }
        }
        
        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤
        function filterOrders(orders) {
            if (!searchFilter) {
                return orders;
            }
            
            return orders.filter(order => {
                // –ü–æ–∏—Å–∫ –ø–æ –æ—Å–Ω–æ–≤–Ω—ã–º –ø–æ–ª—è–º –∑–∞–∫–∞–∑–∞
                const orderFields = [
                    order.number,
                    order.client || order.manager,
                    order.product || order.operationType,
                    SECTIONS[order.currentSection]?.name || '–ù–æ–≤—ã–π –∑–∞–∫–∞–∑'
                ].join(' ').toLowerCase();
                
                // –ü–æ–∏—Å–∫ –ø–æ –ø—Ä–æ–±–ª–µ–º–∞–º
                const issueFields = order.issues ? 
                    order.issues.map(issue => issue.description).join(' ').toLowerCase() : '';
                
                return orderFields.includes(searchFilter) || issueFields.includes(searchFilter);
            });
        }

        // –ü–æ–∫–∞–∑ –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function showStatistics(orders) {
            const stats = {
                total: orders.length,
                inProgress: orders.filter(o => o.currentSection && o.currentSection !== 'shipped').length,
                completed: orders.filter(o => o.currentSection === 'shipped').length,
                new: orders.filter(o => !o.currentSection).length
            };

            const statsHTML = `
                <div class="stat-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-number">${stats.total}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚öôÔ∏è</div>
                    <div class="stat-number">${stats.inProgress}</div>
                    <div class="stat-label">–í –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-number">${stats.completed}</div>
                    <div class="stat-label">–û—Ç–≥—Ä—É–∂–µ–Ω–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìã</div>
                    <div class="stat-number">${stats.new}</div>
                    <div class="stat-label">–ù–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã</div>
                </div>
            `;

            document.getElementById('statsOverview').innerHTML = statsHTML;
        }

        // –ü–æ–∫–∞–∑ –æ—Ç—á–µ—Ç–æ–≤ –ø–æ –∑–∞–∫–∞–∑–∞–º
        function showOrderReports(orders) {
            const reportsContainer = document.getElementById('reportsContainer');
            
            if (orders.length === 0) {
                const emptyText = searchFilter ? 
                    '–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –∑–∞–∫–∞–∑—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã' : 
                    '–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è –æ—Ç—á–µ—Ç–∞';
                const emptySubtext = searchFilter ? 
                    '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å' : 
                    '–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑ –≤ –¥–∞—à–±–æ—Ä–¥–µ';
                    
                reportsContainer.innerHTML = `
                    <div class="empty-reports">
                        <div class="icon">üìã</div>
                        <div class="text">${emptyText}</div>
                        <div class="subtext">${emptySubtext}</div>
                    </div>
                `;
                return;
            }

            let reportsHTML = '';
            
            orders.forEach(order => {
                const progress = calculateOrderProgress(order);
                const currentSectionName = order.currentSection ? SECTIONS[order.currentSection].name : '–ù–æ–≤—ã–π –∑–∞–∫–∞–∑';
                const issuesCount = order.issues ? order.issues.length : 0;
                const issuesBadge = issuesCount > 0 ? `<span style="color: #e74c3c; font-weight: bold; margin-left: 10px;">‚ö†Ô∏è ${issuesCount} –ø—Ä–æ–±–ª–µ–º(—ã)</span>` : '';
                
                reportsHTML += `
                    <div class="report-card">
                        <div class="report-header">
                            <div class="order-title">
                                üì¶ ${order.number} - ${order.product || order.operationType}${issuesBadge}
                            </div>
                            <div class="order-date">${formatDate(order.date)}</div>
                        </div>
                        
                        <div class="order-info">
                            <div class="info-row">
                                <span class="info-label">–ö–ª–∏–µ–Ω—Ç:</span>
                                <span class="info-value">${order.client || order.manager}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">–¢–æ–≤–∞—Ä:</span>
                                <span class="info-value">${order.product || order.operationType}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞:</span>
                                <span class="info-value">${formatDate(order.date)}</span>
                            </div>
                        </div>
                        
                        <div class="current-status">
                            <div class="status-title">–¢–µ–∫—É—â–∏–π —É—á–∞—Å—Ç–æ–∫: ${currentSectionName}</div>
                            <div class="progress-container">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${progress}%"></div>
                                </div>
                                <div class="progress-text">${progress}% –∑–∞–≤–µ—Ä—à–µ–Ω–æ</div>
                            </div>
                        </div>
                        
                        <div class="logistics-chain">
                            <div class="chain-title">
                                üîÑ –¶–µ–ø–æ—á–∫–∞ –ª–æ–≥–∏—Å—Ç–∏–∫–∏
                            </div>
                            ${generateLogisticsChain(order)}
                        </div>
                        
                        ${issuesCount > 0 ? generateIssuesPreview(order.issues) : ''}
                    </div>
                `;
            });
            
            reportsContainer.innerHTML = reportsHTML;
        }
        
        // === –û–¢–ß–ï–¢–´ –ü–û –ü–†–û–ë–õ–ï–ú–ê–ú ===
        
        // –ü–æ–∫–∞–∑ –æ—Ç—á–µ—Ç–æ–≤ –ø–æ –ø—Ä–æ–±–ª–µ–º–∞–º
        function showIssuesReports(orders) {
            console.log('–ü–æ–∫–∞–∑ –ø—Ä–æ–±–ª–µ–º. –í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤:', orders.length);
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã
            const allIssues = [];
            orders.forEach(order => {
                console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–∫–∞–∑:', order.number, '–ü—Ä–æ–±–ª–µ–º—ã:', order.issues);
                if (order.issues && order.issues.length > 0) {
                    order.issues.forEach(issue => {
                        allIssues.push({
                            ...issue,
                            orderNumber: order.number,
                            orderProduct: order.product || order.operationType,
                            orderClient: order.client || order.manager
                        });
                    });
                }
            });
            
            console.log('–ù–∞–π–¥–µ–Ω–æ –ø—Ä–æ–±–ª–µ–º:', allIssues.length);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–æ–±–ª–µ–º
            showIssuesStatistics(allIssues);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–±–ª–µ–º
            const issuesContainer = document.getElementById('issuesContainer');
            
            if (allIssues.length === 0) {
                const emptyText = searchFilter ? 
                    '–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –ø—Ä–æ–±–ª–µ–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã' : 
                    '–ü—Ä–æ–±–ª–µ–º –Ω–µ –Ω–∞–π–¥–µ–Ω–æ';
                const emptySubtext = searchFilter ? 
                    '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å' : 
                    '–í—Å–µ –∑–∞–∫–∞–∑—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –±–µ–∑ –ø—Ä–æ–±–ª–µ–º';
                    
                issuesContainer.innerHTML = `
                    <div class="empty-reports">
                        <div class="icon">‚úÖ</div>
                        <div class="text">${emptyText}</div>
                        <div class="subtext">${emptySubtext}</div>
                    </div>
                `;
                return;
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø—Ä–æ–±–ª–µ–º—ã –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
            allIssues.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            let issuesHTML = '';
            allIssues.forEach(issue => {
                issuesHTML += `
                    <div class="issue-item">
                        <div class="issue-header">
                            <div class="issue-order">‚ö†Ô∏è –ó–∞–∫–∞–∑ ${issue.orderNumber}</div>
                            <div class="issue-date">${formatDateTime(issue.timestamp)}</div>
                        </div>
                        
                        <div style="margin-bottom: 10px; color: #7f8c8d; font-size: 14px;">
                            <strong>–ö–ª–∏–µ–Ω—Ç:</strong> ${issue.orderClient} | <strong>–¢–æ–≤–∞—Ä:</strong> ${issue.orderProduct}
                        </div>
                        
                        <div class="issue-description">
                            ${issue.description}
                        </div>
                        
                        <div class="issue-meta">
                            <span>–ê–≤—Ç–æ—Ä: ${issue.user}</span>
                            <span>${issue.resolved ? '‚úÖ –†–µ—à–µ–Ω–æ' : 'üîÑ –í —Ä–∞–±–æ—Ç–µ'}</span>
                            <button class="issue-order-btn" onclick="goToOrder('${issue.orderNumber}')">
                                üìã –ü–µ—Ä–µ–π—Ç–∏ –∫ –∑–∞–∫–∞–∑—É
                            </button>
                        </div>
                    </div>
                `;
            });
            
            issuesContainer.innerHTML = issuesHTML;
        }
        
        // –ü–æ–∫–∞–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º
        function showIssuesStatistics(issues) {
            const activeIssues = issues.filter(issue => !issue.resolved);
            const resolvedIssues = issues.filter(issue => issue.resolved);
            
            const statsHTML = `
                <div class="issue-stat-card">
                    <div class="issue-stat-number">${issues.length}</div>
                    <div class="issue-stat-label">–í—Å–µ–≥–æ –ø—Ä–æ–±–ª–µ–º</div>
                </div>
                <div class="issue-stat-card">
                    <div class="issue-stat-number">${activeIssues.length}</div>
                    <div class="issue-stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
                </div>
                <div class="issue-stat-card">
                    <div class="issue-stat-number">${resolvedIssues.length}</div>
                    <div class="issue-stat-label">–†–µ—à–µ–Ω–Ω—ã—Ö</div>
                </div>
            `;
            
            document.getElementById('issuesStats').innerHTML = statsHTML;
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–µ–≤—å—é –ø—Ä–æ–±–ª–µ–º –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–∫–∞–∑–∞
        function generateIssuesPreview(issues) {
            if (!issues || issues.length === 0) return '';
            
            const activeIssues = issues.filter(issue => !issue.resolved);
            const recentIssue = issues[issues.length - 1];
            
            return `
                <div style="margin-top: 20px; padding: 15px; background: #fff5f5; border-radius: 8px; border-left: 4px solid #e74c3c;">
                    <div style="font-weight: 600; color: #e74c3c; margin-bottom: 8px;">
                        ‚ö†Ô∏è –ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–±–ª–µ–º–∞ (${formatDateTime(recentIssue.timestamp)})
                    </div>
                    <div style="font-size: 14px; color: #2c3e50;">
                        ${recentIssue.description.substring(0, 100)}${recentIssue.description.length > 100 ? '...' : ''}
                    </div>
                    ${activeIssues.length > 0 ? `<div style="font-size: 12px; color: #e74c3c; margin-top: 5px;">üîÑ ${activeIssues.length} –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º</div>` : ''}
                </div>
            `;
        }
        
        // === –ê–ù–ê–õ–ò–¢–ò–ö–ê ===
        
        // –ü–æ–∫–∞–∑ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
        function showAnalytics(orders) {
            const analyticsContainer = document.getElementById('analyticsContainer');
            
            // –ü–æ–¥—Å—á–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            const stats = {
                total: orders.length,
                inProgress: orders.filter(o => o.currentSection && o.currentSection !== 'shipped').length,
                completed: orders.filter(o => o.currentSection === 'shipped').length,
                new: orders.filter(o => !o.currentSection).length,
                withIssues: orders.filter(o => o.issues && o.issues.length > 0).length
            };
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —É—á–∞—Å—Ç–∫–∞–º
            const sectionStats = {};
            Object.keys(SECTIONS).forEach(section => {
                sectionStats[section] = orders.filter(o => o.currentSection === section).length;
            });
            
            let analyticsHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                    <div class="stat-card">
                        <div class="stat-icon">üìä</div>
                        <div class="stat-number">${stats.total}</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">‚öôÔ∏è</div>
                        <div class="stat-number">${stats.inProgress}</div>
                        <div class="stat-label">–í –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-number">${stats.completed}</div>
                        <div class="stat-label">–û—Ç–≥—Ä—É–∂–µ–Ω–æ</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">‚ö†Ô∏è</div>
                        <div class="stat-number">${stats.withIssues}</div>
                        <div class="stat-label">–° –ø—Ä–æ–±–ª–µ–º–∞–º–∏</div>
                    </div>
                </div>
                
                <div class="report-card">
                    <h3 style="color: #2c3e50; margin-bottom: 15px;">–ó–∞–∫–∞–∑—ã –ø–æ —É—á–∞—Å—Ç–∫–∞–º</h3>
            `;
            
            Object.keys(SECTIONS).forEach(sectionKey => {
                const section = SECTIONS[sectionKey];
                const count = sectionStats[sectionKey];
                const percentage = stats.total > 0 ? Math.round((count / stats.total) * 100) : 0;
                
                analyticsHTML += `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <span>${section.icon} ${section.name}</span>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 100px; height: 8px; background: #ecf0f1; border-radius: 4px;">
                                <div style="width: ${percentage}%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 4px;"></div>
                            </div>
                            <span style="font-weight: bold; min-width: 30px;">${count}</span>
                        </div>
                    </div>
                `;
            });
            
            analyticsHTML += '</div>';
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç—Ä–µ–Ω–¥—ã –µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ
            if (orders.length > 0) {
                analyticsHTML += generateTrendsAnalysis(orders);
            }
            
            analyticsContainer.innerHTML = analyticsHTML;
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ —Ç—Ä–µ–Ω–¥–æ–≤
        function generateTrendsAnalysis(orders) {
            const issuesCount = orders.reduce((total, order) => 
                total + (order.issues ? order.issues.length : 0), 0);
            
            const avgProgress = orders.length > 0 ? 
                Math.round(orders.reduce((total, order) => 
                    total + calculateOrderProgress(order), 0) / orders.length) : 0;
            
            return `
                <div class="report-card" style="margin-top: 20px;">
                    <h3 style="color: #2c3e50; margin-bottom: 15px;">üìà –ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                            <div style="font-size: 2rem; margin-bottom: 10px;">üìä</div>
                            <div style="font-size: 24px; font-weight: bold; color: #2c3e50;">${avgProgress}%</div>
                            <div style="color: #7f8c8d;">–°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å</div>
                        </div>
                        
                        <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                            <div style="font-size: 2rem; margin-bottom: 10px;">‚ö†Ô∏è</div>
                            <div style="font-size: 24px; font-weight: bold; color: #e74c3c;">${issuesCount}</div>
                            <div style="color: #7f8c8d;">–í—Å–µ–≥–æ –ø—Ä–æ–±–ª–µ–º</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ü–µ–ø–æ—á–∫–∏ –ª–æ–≥–∏—Å—Ç–∏–∫–∏
        function generateLogisticsChain(order) {
            let chainHTML = '';
            const sectionKeys = Object.keys(SECTIONS);
            
            sectionKeys.forEach(sectionKey => {
                const section = SECTIONS[sectionKey];
                const historyItem = order.history.find(h => h.section === sectionKey);
                
                if (historyItem) {
                    const isCurrentSection = order.currentSection === sectionKey;
                    const className = isCurrentSection ? 'current' : 'completed';
                    const icon = isCurrentSection ? 'üü°' : '‚úÖ';
                    const statusText = isCurrentSection ? ' - —Ç–µ–∫—É—â–∏–π' : '';
                    const timeText = formatDateTime(historyItem.timestamp);
                    
                    chainHTML += `
                        <div class="chain-item ${className}">
                            <span class="chain-icon">${icon}</span>
                            <span class="chain-text">–ü–µ—Ä–µ–º–µ—â–µ–Ω –Ω–∞ ${section.name}${statusText}</span>
                            <span class="chain-time">${timeText}</span>
                        </div>
                    `;
                } else {
                    chainHTML += `
                        <div class="chain-item pending">
                            <span class="chain-icon">‚ö™</span>
                            <span class="chain-text">${section.name}</span>
                            <span class="chain-time">–û–∂–∏–¥–∞–Ω–∏–µ</span>
                        </div>
                    `;
                }
            });
            
            return chainHTML;
        }

        // –ü–µ—Ä–µ—Ö–æ–¥ –∫ –∑–∞–∫–∞–∑—É —Å –ø–æ–∏—Å–∫–æ–º
        function goToOrder(orderNumber) {
            // –û—Ç–∫—Ä—ã–≤–∞–µ–º –¥–∞—à–±–æ—Ä–¥ —Å –ø–æ–∏—Å–∫–æ–º –ø–æ –Ω–æ–º–µ—Ä—É –∑–∞–∫–∞–∑–∞
            const searchQuery = encodeURIComponent(orderNumber);
            window.location.href = `mobile_order_dashboard.html?search=${searchQuery}`;
        }
    </script>
</body>
</html>